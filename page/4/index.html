<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-读书笔记『HeadFirst-设计模式』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/12/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8EHeadFirst-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/" class="article-date">
  <time datetime="2019-05-12T05:44:35.000Z" itemprop="datePublished">2019-05-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/12/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8EHeadFirst-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/">读书笔记『HeadFirst-设计模式』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>时隔5年，重读《Head First 设计模式》，这本书写的很很好，语言生动，举的例子很形象。看着很顺畅，下面按内容顺序略做笔记。</p>
<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><h4 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h4><p>定义了算法族，分别封装起来，让它们之间可以相互替换，<strong>此模式让算法的变化独立于使用算法的客户。</strong></p>
<h4 id="个人理解"><a href="#个人理解" class="headerlink" title="个人理解"></a>个人理解</h4><ol>
<li>封装所有可能发生变化的算法成一个独立的算法族。</li>
<li>对象持有算法族接口对象的引用。</li>
<li>对象方法委托算法族接口对象去实现。</li>
<li><strong>有一个</strong>比<strong>是一个</strong>更好，或者说<strong>多用组合，少用继承</strong>。</li>
</ol>
        
          <p class="article-more-link">
            <a href="/2019/05/12/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8EHeadFirst-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/05/12/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8EHeadFirst-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/" data-id="ck85a4u600051tw2636u0cins" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-开源项目——Retrofit『基础使用』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/29/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94Retrofit%E3%80%8E%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E3%80%8F/" class="article-date">
  <time datetime="2019-04-29T12:17:25.000Z" itemprop="datePublished">2019-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/29/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94Retrofit%E3%80%8E%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E3%80%8F/">Retrofit『使用』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Retrofit的优点"><a href="#Retrofit的优点" class="headerlink" title="Retrofit的优点"></a>Retrofit的优点</h4><ol>
<li>可以配置不同HTTP client来实现网络请求，如okhttp、httpclient等 </li>
<li>将接口的定义与使用分离开来，实现结构。</li>
<li>支持多种返回数据解析的Converter可以快速进行数据转换。</li>
<li>和RxJava集成的很好</li>
<li>因为容易和RxJava结合使用，所以对于异步请求，同步请求也不需要做额外的工作。</li>
<li>Retrofit是基于OKHttp</li>
</ol>
<h4 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h4><h5 id="配置依赖"><a href="#配置依赖" class="headerlink" title="配置依赖"></a>配置依赖</h5><p>在module的build.gradle中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Retrofit</span></span><br><span class="line">api <span class="string">"com.squareup.retrofit2:retrofit:2.3.0"</span></span><br><span class="line">api <span class="string">"com.squareup.retrofit2:converter-gson:2.3.0"</span></span><br><span class="line">api <span class="string">"com.squareup.retrofit2:adapter-rxjava2:2.3.0"</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// OkHttp3</span></span><br><span class="line">api <span class="string">"com.squareup.okhttp3:okhttp:3.10.0"</span></span><br><span class="line">api <span class="string">"com.squareup.okhttp3:logging-interceptor:3.10.0"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// RxJava2</span></span><br><span class="line">api <span class="string">"io.reactivex.rxjava2:rxjava:2.1.9"</span></span><br><span class="line">api <span class="string">"io.reactivex.rxjava2:rxandroid:2.0.2"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// RxLifecycle</span></span><br><span class="line">api <span class="string">"com.trello.rxlifecycle2:rxlifecycle:2.2.1"</span></span><br><span class="line">api <span class="string">"com.trello.rxlifecycle2:rxlifecycle-android:2.2.1"</span></span><br><span class="line">api <span class="string">"com.trello.rxlifecycle2:rxlifecycle-components:2.2.1"</span></span><br></pre></td></tr></table></figure>

<h5 id="定义Retrofit单例"><a href="#定义Retrofit单例" class="headerlink" title="定义Retrofit单例"></a>定义Retrofit单例</h5><p>在Application中初始化Retrofit，因为一个Retrofit对象本身就包含一个线程池，所以我们可以初始化一个Retrofit对象，并将其做成一个全局单例对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Retrofit单例管理</span></span><br><span class="line"><span class="comment"> * Created by Leon.W on 2019/4/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RetrofitManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String BASE_URL = <span class="string">"https://api.github.com"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RetrofitManager sInstance;</span><br><span class="line">    <span class="keyword">private</span> Retrofit mRetrofit;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RetrofitManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == sInstance) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (RetrofitManager<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == sInstance) &#123;</span><br><span class="line">                    sInstance = <span class="keyword">new</span> RetrofitManager();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mRetrofit == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//初始化一个OkHttpClient</span></span><br><span class="line">            OkHttpClient.Builder builder = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">                    .connectTimeout(<span class="number">30000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">                    .readTimeout(<span class="number">30000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">                    .writeTimeout(<span class="number">30000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">            builder.addInterceptor(<span class="keyword">new</span> LoggingInterceptor());</span><br><span class="line">            OkHttpClient okHttpClient = builder.build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用该OkHttpClient创建一个Retrofit对象</span></span><br><span class="line">            mRetrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">                    <span class="comment">//添加Gson数据格式转换器支持</span></span><br><span class="line">                    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                    <span class="comment">//添加RxJava语言支持</span></span><br><span class="line">                    .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                    <span class="comment">//指定网络请求client</span></span><br><span class="line">                    .client(okHttpClient)</span><br><span class="line">                    .baseUrl(BASE_URL)</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">getRetrofit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mRetrofit == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> IllegalStateException(<span class="string">"Retrofit instance hasn't init!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mRetrofit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="定义ApiService"><a href="#定义ApiService" class="headerlink" title="定义ApiService"></a>定义ApiService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ApiService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"/TP_S/BookList"</span>)</span><br><span class="line">    Observable&lt;JsonArrayBase&lt;Book&gt;&gt; queryBookList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="定义接口方法实现方法"><a href="#定义接口方法实现方法" class="headerlink" title="定义接口方法实现方法"></a>定义接口方法实现方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GithubAPI.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GithubAPI</span> </span>&#123;</span><br><span class="line">    <span class="function">Observable&lt;GithubUserInfo&gt; <span class="title">queryJakeWhartonInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RetrofitManager.getInstance().getRetrofit()</span><br><span class="line">                <span class="comment">//动态代理创建GithubAPI对象</span></span><br><span class="line">                .create(ApiService<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">                .<span class="title">queryJakeWhartonInfo</span>()</span></span><br><span class="line"><span class="class">                //指定上游发送事件线程</span></span><br><span class="line"><span class="class">                .<span class="title">subscribeOn</span>(<span class="title">Schedulers</span>.<span class="title">computation</span>())</span></span><br><span class="line"><span class="class">                //指定下游接收事件线程</span></span><br><span class="line"><span class="class">                .<span class="title">observeOn</span>(<span class="title">AndroidSchedulers</span>.<span class="title">mainThread</span>())</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="定义返回数据实体类"><a href="#定义返回数据实体类" class="headerlink" title="定义返回数据实体类"></a>定义返回数据实体类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GithubUserInfo</span> </span>&#123;</span><br><span class="line">    String login,url,name,company;</span><br><span class="line">    <span class="keyword">int</span> id,public_repos,followers;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"GithubUserInfo&#123;"</span> +</span><br><span class="line">                <span class="string">"login='"</span> + login + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", url='"</span> + url + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", company='"</span> + company + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", id="</span> + id +</span><br><span class="line">                <span class="string">", public_repos="</span> + public_repos +</span><br><span class="line">                <span class="string">", followers="</span> + followers +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="调用接口"><a href="#调用接口" class="headerlink" title="调用接口"></a>调用接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> GithubAPI().queryJakeWhartonInfo().subscribe(<span class="keyword">new</span> Observer&lt;GithubUserInfo&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(GithubUserInfo githubUserInfo)</span> </span>&#123;</span><br><span class="line">        Log.d(TAG,githubUserInfo.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        Log.e(TAG,e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;输出：</span><br><span class="line">D/TestRetrofit: GithubUserInfo&#123;login=<span class="string">'JakeWharton'</span>, url=<span class="string">'https://api.github.com/users/JakeWharton'</span>, name=<span class="string">'Jake Wharton'</span>, company=<span class="string">'Google, Inc.'</span>, id=<span class="number">66577</span>, public_repos=<span class="number">102</span>, followers=<span class="number">52467</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>请求过程中的异常一般分为2种类型，一种是类似网络异常、服务器这种环境问题；另一种比如请求参数错误、登录超时、Token失效等异常。分别做如下处理</p>
<h5 id="环境问题"><a href="#环境问题" class="headerlink" title="环境问题"></a>环境问题</h5><p>环境异常诸如404、500、502等服务器状态异常，或者设备本身网路异常造成的，这种时候的Exception会在onError方法中得到响应。</p>
<h5 id="数据问题"><a href="#数据问题" class="headerlink" title="数据问题"></a>数据问题</h5><p>数据问题诸如请求参数异常、对象为空、登录超时等数据相关异常，这种情况Response还是会走onNext方法，只是我们需要在里面根据自定义的code，来处理各种数据异常。</p>
<p>下面是一个具体的基础Observer类，在其onNext中解析</p>
<p>一般服务器接口返回数据会约定一个简单的格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code:<span class="keyword">int</span>,</span><br><span class="line">    msg:String,</span><br><span class="line">    data:&#123;&#125; <span class="comment">//可能是对象，有可能是数组data:[]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>对应的建议解析类，一般当接口返回先解析其code是否为成功，如果不是，那看看是否是特定的错误码，把错误码code和错误信息msg包装成一个自定义的Exception进行处理。如果成功，则对返回结果进行进一步的解析，针对不同的接口解析成“对象”或者“数组”。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JsonBase.java，解析code和msg</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonBase</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6182189632617616248L</span>;</span><br><span class="line">	<span class="meta">@SerializedName</span>(<span class="string">"msg"</span>)</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> code = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> code;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> msg;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JsonArrayBase.java，解析数组类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonArrayBase</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">JsonBase</span> </span>&#123;</span><br><span class="line">	<span class="meta">@SerializedName</span>(<span class="string">"data"</span>)</span><br><span class="line">	List&lt;T&gt; data;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(List&lt;T&gt; data)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; data.size(); i++) &#123;</span><br><span class="line">			sb.append(data.get(i).toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JsonObjBase.java，解析对象类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonObjBase</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">JsonBase</span> </span>&#123;</span><br><span class="line">	<span class="meta">@SerializedName</span>(<span class="string">"data"</span>)</span><br><span class="line">	T data;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基础Observer，用于处理数据异常(即code不是SUCC的情况)；网络异常(在onError方法中进行toast提示)，<strong>具体使用界面可以通过重写onError来得到回调(比如分页加载失败，需要隐藏加载进度条，此时需要得到失败回调)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BaseObserver.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseObserver</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Observer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"BaseObserver"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            onError(HttpCode.ERROR_EMPTY_OBJ, getErrorMessage(HttpCode.ERROR_EMPTY_OBJ));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            onSuccess(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 外部想要处理异常(比如分页加载失败，需要隐藏加载中效果)时，可以重写该方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(<span class="keyword">int</span> errorCode, String message)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 外部重写，接受数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不显示服务器返回错误信息(部分接口返回不规范)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isShowErrorToast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> errorCode = -<span class="number">1</span>;</span><br><span class="line">        String errMsg = <span class="string">""</span>;</span><br><span class="line">        <span class="comment">//自定义异常</span></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MyException) &#123;</span><br><span class="line">            MyException exception = (MyException) e;</span><br><span class="line">            errorCode = exception.getErrorCode();</span><br><span class="line">            errMsg = exception.getMessage();</span><br><span class="line">            handleIybErrorCode(errorCode);</span><br><span class="line">            <span class="keyword">if</span> (isShowErrorToast()) &#123;</span><br><span class="line">                Toast.makeText(TestAPP.getInstance().getApplicationContext(), errMsg,Toast.LENGTH_LONG).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> NullPointerException) &#123; <span class="comment">// RxJava2 发送值为null时，不执行 onNext，直接走 onError</span></span><br><span class="line">            errorCode = HttpCode.ERROR_EMPTY_OBJ;</span><br><span class="line">            errMsg = getErrorMessage(HttpCode.ERROR_EMPTY_OBJ);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> SocketTimeoutException) &#123;</span><br><span class="line">            errorCode = HttpCode.ERROR_TIMEOUT;</span><br><span class="line">            errMsg = getErrorMessage(HttpCode.ERROR_TIMEOUT);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), errMsg,Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> NetworkErrorException) &#123;</span><br><span class="line">            errorCode = HttpCode.ERROR_NETWORK;</span><br><span class="line">            errMsg = getErrorMessage(HttpCode.ERROR_NETWORK);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), errMsg,Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> HttpException) &#123;</span><br><span class="line">            HttpException httpException = (HttpException) e;</span><br><span class="line">            errMsg = httpException != <span class="keyword">null</span> ? httpException.getMessage() : getErrorMessage(HttpCode.ERROR_SERVER_EXCEPTION);</span><br><span class="line">            <span class="keyword">int</span> httpErrorCode = httpException != <span class="keyword">null</span> ? httpException.code() : HttpCode.ERROR_UNKNOWN;</span><br><span class="line">            Log.d(TAG, <span class="string">"Http request error:"</span> + <span class="string">"message="</span> + errMsg + <span class="string">" :::: "</span> + <span class="string">"httpErrorCode="</span> + httpErrorCode);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), getErrorMessage(HttpCode.ERROR_SERVER_EXCEPTION),Toast.LENGTH_LONG).show(); <span class="comment">// 统一提示服务器异常</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            errMsg = e != <span class="keyword">null</span> ? e.getMessage() : getErrorMessage(HttpCode.ERROR_UNKNOWN);</span><br><span class="line">        &#125;</span><br><span class="line">        onError(errorCode, errMsg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理数据异常code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> errorCode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleIybErrorCode</span><span class="params">(<span class="keyword">int</span> errorCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (errorCode == HttpCode.ERROR_ALREADY_REGISTER) &#123;</span><br><span class="line">            <span class="comment">//已注册处理逻辑</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (errorCode == HttpCode.ERROR_LOGIN_EXPIRED ) &#123;</span><br><span class="line">            <span class="comment">//登录超时处理逻辑</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getErrorMessage</span><span class="params">(<span class="keyword">int</span> errorCode)</span> </span>&#123;</span><br><span class="line">        String message = HttpCode.ERRORS.get(errorCode);</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(message)) &#123;</span><br><span class="line">            message = HttpCode.ERRORS.get(HttpCode.ERROR_UNKNOWN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseObserver</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Observer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"BaseObserver"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            onError(HttpCode.ERROR_EMPTY_OBJ, getErrorMessage(HttpCode.ERROR_EMPTY_OBJ));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            onSuccess(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**外部想要处理异常时(比如分页加载失败，需要隐藏加载中效果)，可以重写该方法*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(<span class="keyword">int</span> errorCode, String message)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 不显示服务器返回错误信息(部分接口返回不规范) */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isShowErrorToast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> errorCode = -<span class="number">1</span>;</span><br><span class="line">        String errMsg = <span class="string">""</span>;</span><br><span class="line">        <span class="comment">//自定义异常</span></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MyException) &#123;</span><br><span class="line">            MyException exception = (MyException) e;</span><br><span class="line">            errorCode = exception.getErrorCode();</span><br><span class="line">            errMsg = exception.getMessage();</span><br><span class="line">            handleErrorCode(errorCode);</span><br><span class="line">            <span class="keyword">if</span> (isShowErrorToast()) &#123;</span><br><span class="line">                Toast.makeText(TestAPP.getInstance().getApplicationContext(), errMsg,Toast.LENGTH_LONG).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> NullPointerException) &#123; <span class="comment">// RxJava2 发送值为null时，不执行 onNext，直接走 onError</span></span><br><span class="line">            errorCode = HttpCode.ERROR_EMPTY_OBJ;</span><br><span class="line">            errMsg = getErrorMessage(HttpCode.ERROR_EMPTY_OBJ);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> SocketTimeoutException) &#123;</span><br><span class="line">            errorCode = HttpCode.ERROR_TIMEOUT;</span><br><span class="line">            errMsg = getErrorMessage(HttpCode.ERROR_TIMEOUT);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), errMsg,Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> NetworkErrorException) &#123;</span><br><span class="line">            errorCode = HttpCode.ERROR_NETWORK;</span><br><span class="line">            errMsg = getErrorMessage(HttpCode.ERROR_NETWORK);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), errMsg,Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> HttpException) &#123;</span><br><span class="line">            HttpException httpException = (HttpException) e;</span><br><span class="line">            errMsg = httpException != <span class="keyword">null</span> ? httpException.getMessage() : getErrorMessage(HttpCode.ERROR_SERVER_EXCEPTION);</span><br><span class="line">            <span class="keyword">int</span> httpErrorCode = httpException != <span class="keyword">null</span> ? httpException.code() : HttpCode.ERROR_UNKNOWN;</span><br><span class="line">            Log.d(TAG, <span class="string">"Http request error:"</span> + <span class="string">"message="</span> + errMsg + <span class="string">" :::: "</span> + <span class="string">"httpErrorCode="</span> + httpErrorCode);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), getErrorMessage(HttpCode.ERROR_SERVER_EXCEPTION),Toast.LENGTH_LONG).show(); <span class="comment">// 统一提示服务器异常</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            errMsg = e != <span class="keyword">null</span> ? e.getMessage() : getErrorMessage(HttpCode.ERROR_UNKNOWN);</span><br><span class="line">            Toast.makeText(TestAPP.getInstance().getApplicationContext(), e.getMessage(),Toast.LENGTH_LONG).show(); <span class="comment">// 统一提示服务器异常</span></span><br><span class="line">        &#125;</span><br><span class="line">        onError(errorCode, errMsg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理数据异常code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> errorCode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleErrorCode</span><span class="params">(<span class="keyword">int</span> errorCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (errorCode == HttpCode.ERROR_ALREADY_REGISTER) &#123;</span><br><span class="line">            <span class="comment">//已注册处理逻辑</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (errorCode == HttpCode.ERROR_LOGIN_EXPIRED ) &#123;</span><br><span class="line">            <span class="comment">//登录超时处理逻辑</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getErrorMessage</span><span class="params">(<span class="keyword">int</span> errorCode)</span> </span>&#123;</span><br><span class="line">        String message = HttpCode.ERRORS.get(errorCode);</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(message)) &#123;</span><br><span class="line">            message = HttpCode.ERRORS.get(HttpCode.ERROR_UNKNOWN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyException.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mErrorCode;</span><br><span class="line">    <span class="keyword">private</span> String mMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(<span class="keyword">int</span> errorCode, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        mErrorCode = errorCode;</span><br><span class="line">        mMessage = message;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getErrorCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mErrorCode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setErrorCode</span><span class="params">(<span class="keyword">int</span> mErrorCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mErrorCode = mErrorCode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mMessage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mMessage = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpCode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_UNKNOWN = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_SUCCESS = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 1000~1099 自定义错误码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_NETWORK = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_TIMEOUT = <span class="number">1001</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_SERVER_EXCEPTION = <span class="number">1002</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_EMPTY_OBJ = <span class="number">1011</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_ALREADY_REGISTER = <span class="number">100001</span>; <span class="comment">// 已经注册过</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ERROR_LOGIN_EXPIRED = <span class="number">100002</span>; <span class="comment">// 登录cookie超时,需要重新登录</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SparseArray&lt;String&gt; ERRORS = <span class="keyword">new</span> SparseArray&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ERRORS.append(ERROR_UNKNOWN, <span class="string">"未知错误"</span>);</span><br><span class="line">        ERRORS.append(ERROR_SUCCESS, <span class="string">"请求成功"</span>);</span><br><span class="line">        ERRORS.append(ERROR_NETWORK, <span class="string">"网络错误"</span>);</span><br><span class="line">        ERRORS.append(ERROR_TIMEOUT, <span class="string">"连接超时"</span>);</span><br><span class="line">        ERRORS.append(ERROR_SERVER_EXCEPTION, <span class="string">"服务器异常"</span>);</span><br><span class="line">        ERRORS.append(ERROR_ALREADY_REGISTER, <span class="string">"您的手机号已经注册过i云保帐号"</span>);</span><br><span class="line">        ERRORS.append(ERROR_LOGIN_EXPIRED, <span class="string">"登录超时,需要重新登录"</span>);</span><br><span class="line">        ERRORS.append(ERROR_EMPTY_OBJ, <span class="string">"返回对象为空!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="生命周期绑定"><a href="#生命周期绑定" class="headerlink" title="生命周期绑定"></a>生命周期绑定</h4><p>有时我们关闭一个页面时，希望该页面上正在进行以及准备开始进行的请求能够及时关闭、取消掉。以免造成内存溢出或空指针异常等问题。此时就需要将请求与页面的生命周期相关联。因为Retrofit和RxJava2集成，由RxJava2控制上下游的时间分发，所以<strong>处理RxJava2的生命周期问题就是处理Retrofit请求的声明周期问题。</strong>可以看到在上面的”依赖配置“段落中导入了三个rxlifiecycle相关的依赖，其中rxliftcycle-components包含我们将要使用到的RxAppCompatActivity，而他有依赖另外两个依赖，可以查看RxAppCompatActivity的源码验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RxAppCompatActivity.java</span></span><br><span class="line"><span class="keyword">import</span> com.trello.rxlifecycle2.LifecycleProvider;</span><br><span class="line"><span class="keyword">import</span> com.trello.rxlifecycle2.LifecycleTransformer;</span><br><span class="line"><span class="comment">//来自基础包rxlifecycle</span></span><br><span class="line"><span class="keyword">import</span> com.trello.rxlifecycle2.RxLifecycle; </span><br><span class="line"><span class="comment">//来自android包rxlifecycle-android</span></span><br><span class="line"><span class="keyword">import</span> com.trello.rxlifecycle2.android.ActivityEvent; </span><br><span class="line"><span class="comment">//来自android包rxlifecycle-android</span></span><br><span class="line"><span class="keyword">import</span> com.trello.rxlifecycle2.android.RxLifecycleAndroid;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.Observable;</span><br><span class="line"><span class="keyword">import</span> io.reactivex.subjects.BehaviorSubject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">RxAppCompatActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">LifecycleProvider</span>&lt;<span class="title">ActivityEvent</span>&gt; </span>&#123; </span><br><span class="line">        ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面开始声明周期相关的Demo，演示一下<strong>未绑定页面生命周期导致内存溢出的问题</strong>，假设有一个Activity中有一个operator每隔1秒发送一个事件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMemLeakActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"TestMemLeak"</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.rx_act_test_leak);</span><br><span class="line">        Observable.interval(<span class="number">1000l</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">                .subscribeOn(Schedulers.computation())</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(<span class="keyword">new</span> Observer&lt;Long&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Long aLong)</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG,aLong + <span class="string">""</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG,e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG,<span class="string">"onComplete"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Log.d(TAG,<span class="string">"onDestory------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;&gt;输出：</span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">00.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">0</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">01.101</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">1</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">02.101</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">2</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">03.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">3</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">04.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">4</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">05.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">5</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">05.110</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: onDestory------</span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">06.105</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">6</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">07.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">7</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">08.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">8</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">38</span>:<span class="number">09.102</span> <span class="number">18964</span>-<span class="number">18964</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>从Log可以看出，TestMemLeakActivity关闭调用onDestory()之后，事件没有随着界面关闭而停止发送，这样<strong>会导致Activity无法回收，进而导致内存泄露</strong>。下面使用RxAppCompatActivity进行将RxJava绑定到Activity的声明周期。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.继承自RxAppCompatActivity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMemLeakActivity</span> <span class="keyword">extends</span> <span class="title">RxAppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"TestMemLeak"</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.rx_act_test_leak);</span><br><span class="line">        Observable.interval(<span class="number">1000l</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">                .subscribeOn(Schedulers.computation())</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                <span class="comment">//2.绑定声明周期</span></span><br><span class="line">                .compose(<span class="keyword">this</span>.&lt;Long&gt;bindToLifecycle())</span><br><span class="line">                .subscribe(<span class="keyword">new</span> Observer&lt;Long&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Long aLong)</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG,aLong + <span class="string">""</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG,e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        Log.d(TAG,<span class="string">"onComplete"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Log.d(TAG,<span class="string">"onDestory------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;&gt;输出：</span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">41.254</span> <span class="number">20080</span>-<span class="number">20080</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">0</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">42.254</span> <span class="number">20080</span>-<span class="number">20080</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">1</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">43.254</span> <span class="number">20080</span>-<span class="number">20080</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">2</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">44.253</span> <span class="number">20080</span>-<span class="number">20080</span>/com.ebm.rxjava D/TestMemLeak: <span class="number">3</span></span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">44.762</span> <span class="number">20080</span>-<span class="number">20080</span>/com.ebm.rxjava D/TestMemLeak: onComplete</span><br><span class="line"><span class="number">04</span>-<span class="number">29</span> <span class="number">19</span>:<span class="number">41</span>:<span class="number">44.762</span> <span class="number">20080</span>-<span class="number">20080</span>/com.ebm.rxjava D/TestMemLeak: onDestory------</span><br></pre></td></tr></table></figure>

<p>从上面的Log可以看出，界面关闭之前先发送了onComplete事件，关闭了事件流的发送。</p>
<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><p><strong>19-08-19</strong>：如果要使用Log，需要注意Log会强制要求将所有响应内容加载到内存中，以便进行打印操作。这可能会引发<font color="#dd0000"><strong>OOM</strong></font> 问题，参考JakeWharton的评论回复。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JakeWharton commented on Jun <span class="number">24</span>, <span class="number">2014</span> </span><br><span class="line">By calling .setLogLevel(RestAdapter.LogLevel.FULL) you are forcing Retrofit to buffer the entire request body into memory so that it can log. That’s what the call to readBodyToBytesIfNecessary in the stack trace is doing. </span><br><span class="line">Enabling logging like <span class="keyword">this</span> should only be done when debugging.</span><br></pre></td></tr></table></figure>

<p><strong>19-08-19</strong>：使用<font color="#dd0000"><strong>@Streaming</strong></font>处理大文件下载，避免造成内存溢出。(边下载边写入磁盘，而不是全部下载完成后在写入磁盘)</p>
<p>参考：<a href="https://blog.csdn.net/qqyanjiang/article/details/51076940" target="_blank" rel="noopener">Retrofit（重构——下载大文件）</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/29/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94Retrofit%E3%80%8E%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E3%80%8F/" data-id="ck85a4u5r004ptw2658wq7lm6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Java『设计模式』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/28/Java%E3%80%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/" class="article-date">
  <time datetime="2019-04-28T03:30:22.000Z" itemprop="datePublished">2019-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/28/Java%E3%80%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/">Java『设计模式』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在看源码的过程中经常会遇到一些设计模式，下面做一下记录</p>
<h4 id="责任链"><a href="#责任链" class="headerlink" title="责任链"></a>责任链</h4><p>当你想要让一个以上的对象<strong>有机会</strong>能够处理某个请求的时候，可以使用责任链模式。<strong>链中的每个对象扮演处理器，并且有一个后继对象。它可以处理请求，也可以把请求转发给后继者。</strong></p>
<p>责任链的优点：</p>
<ul>
<li>将请求的发送者和接收者解耦</li>
<li>可以简化你的对象，因为它不需要知道链的结构。</li>
<li>通过改变链内的成员或调动他们的顺序，允许你动态地新增或删除责任。</li>
</ul>
<!-- moe-->

<p>责任链的缺点：</p>
<ul>
<li>可能不容易观察运行时的特征，有碍于除错。</li>
<li>并不能保证请求一定会被执行。</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019042814181333.jpg" alt="img"></p>
<p>看一下实例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Translator</span> </span>&#123;</span><br><span class="line">    Translator next;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">translate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(next != <span class="keyword">null</span>) &#123;</span><br><span class="line">            next.translate(s);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Can't translate Word :"</span> + s.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//!!setNext返回next对象，为了测试调动方便可以链式调用</span></span><br><span class="line">    <span class="function">Translator <span class="title">setNext</span><span class="params">(Translator next)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaiDuTranslator</span> <span class="keyword">extends</span> <span class="title">Translator</span>  </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">translate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.equals(<span class="string">"BaiDu"</span>)) &#123; <span class="comment">//自定义逻辑</span></span><br><span class="line">            System.out.println(<span class="string">"Processed!"</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.translate(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YouDaoTranslator</span> <span class="keyword">extends</span> <span class="title">Translator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">translate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.equals(<span class="string">"YouDao"</span>)) &#123; <span class="comment">//自定义逻辑</span></span><br><span class="line">            System.out.println(<span class="string">"Processed!"</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.translate(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeiKeTranslator</span> <span class="keyword">extends</span> <span class="title">Translator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">translate</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.equals(<span class="string">"BeiKe"</span>)) &#123; <span class="comment">//自定义逻辑</span></span><br><span class="line">            System.out.println(<span class="string">"Processed!"</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.translate(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//测试：</span></span><br><span class="line">BaiDuTranslator translator = <span class="keyword">new</span> BaiDuTranslator();</span><br><span class="line">translator.setNext(<span class="keyword">new</span> YouDaoTranslator()).setNext(<span class="keyword">new</span> BeiKeTranslator());</span><br><span class="line">translator.translate(<span class="string">"Rampage"</span>);</span><br><span class="line">translator.translate(<span class="string">"BeiKe"</span>);</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line">Can<span class="string">'t translate Word :Rampage</span></span><br><span class="line"><span class="string">Processed!</span></span><br></pre></td></tr></table></figure>

<h4 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h4><p>动态代理模式提供了一种通过代理对象访问目标对象的方式，目的是为了在不改变目标对象的代码的前提下<strong>增加</strong>额外的功能。Java中有三种代理模式，分别是静态代理、动态代理、Cglib代理。</p>
<h5 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h5><p>静态代理中代理对象(Proxy)和被代理对象(Target)需要实现相同的接口或继承相同的父类。<strong>这样在外部调用看来他们不知道自己访问的是Target还是Proxy，可以保证原有业务逻辑的连续性。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDesignPattern</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        iTranslate translator = <span class="keyword">new</span> EngTranslatorProxy(<span class="keyword">new</span> EngTranslator());</span><br><span class="line">        System.out.println(translator.translate(<span class="string">"我叫大强My name is DaQiang."</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">iTranslate</span> </span>&#123;</span><br><span class="line">        <span class="function">String <span class="title">translate</span><span class="params">(String source)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EngTranslator</span> <span class="keyword">implements</span> <span class="title">iTranslate</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">translate</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"翻译结果:"</span> + source;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EngTranslatorProxy</span> <span class="keyword">implements</span> <span class="title">iTranslate</span> </span>&#123;</span><br><span class="line">        EngTranslator engTranslator;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EngTranslatorProxy</span><span class="params">(EngTranslator engTranslator)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.engTranslator = engTranslator;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">translate</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//添加过滤中文的逻辑</span></span><br><span class="line">            Pattern pat = Pattern.compile(<span class="string">"[\u4e00-\u9fa5]"</span>);</span><br><span class="line">            Matcher mat = pat.matcher(source);</span><br><span class="line">            source = mat.replaceAll(<span class="string">""</span>);</span><br><span class="line">            <span class="keyword">return</span> engTranslator.translate(source);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;&gt;输出：</span><br><span class="line">翻译结果：My name is DaQiang.</span><br></pre></td></tr></table></figure>

<h5 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h5><p>静态代理每新建一个代理逻辑，就需要新建一个代理对象，这样可能导致产生很多的代理类。和静态代理不同，动态代理<font color="#dd0000"><strong>在内存中构建代理对象</strong></font>，从而不需要创建很多代理类(Proxy)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(((iTranslate)<span class="keyword">new</span> EngTranslatorProxy(</span><br><span class="line">                <span class="keyword">new</span> EngTranslator()).getProxyInstance())</span><br><span class="line">                .translate(<span class="string">"我叫大强My name is DaQiang."</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">iTranslate</span> </span>&#123;</span><br><span class="line">        <span class="function">String <span class="title">translate</span><span class="params">(String source)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EngTranslator</span> <span class="keyword">implements</span> <span class="title">iTranslate</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">translate</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"翻译结果:"</span> + source;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EngTranslatorProxy</span>  </span>&#123;</span><br><span class="line">        EngTranslator engTranslator;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EngTranslatorProxy</span><span class="params">(EngTranslator engTranslator)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.engTranslator = engTranslator;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getProxyInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Proxy.newProxyInstance(engTranslator.getClass().getClassLoader(),</span><br><span class="line">                engTranslator.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="comment">//添加过滤中文的逻辑</span></span><br><span class="line">                        Pattern pat = Pattern.compile(<span class="string">"[\u4e00-\u9fa5]"</span>);</span><br><span class="line">                        Matcher mat = pat.matcher(args[<span class="number">0</span>].toString());</span><br><span class="line">                        String filterSource = mat.replaceAll(<span class="string">""</span>);</span><br><span class="line">                        Object returnValue = method.invoke(engTranslator,filterSource);</span><br><span class="line">                        <span class="keyword">return</span> returnValue;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&gt;&gt;&gt;输出：</span><br><span class="line">翻译结果:My name is DaQiang.</span><br></pre></td></tr></table></figure>

<h5 id="Cglib代理"><a href="#Cglib代理" class="headerlink" title="Cglib代理"></a>Cglib代理</h5><p>静态代理和动态代理都需要目标对象实现一个接口。然而有时候目标对象没法实现接口，就是一个类。此时<font color="#dd0000"><strong>可以使用继承的方式扩展其子类的功能</strong></font>，在Java中，可以使用Cglib这个库，在内存中构建一个目标对象的子类对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标对象,没有实现任何接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"----已经保存数据!----"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Cglib代理工厂：ProxyFactory.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cglib子类代理工厂</span></span><br><span class="line"><span class="comment"> * 对UserDao在内存中动态构建一个子类对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyFactory</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span></span>&#123;</span><br><span class="line">    <span class="comment">//维护目标对象</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyFactory</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给目标对象创建一个代理对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//1.工具类</span></span><br><span class="line">        Enhancer en = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">//2.设置父类</span></span><br><span class="line">        en.setSuperclass(target.getClass());</span><br><span class="line">        <span class="comment">//3.设置回调函数</span></span><br><span class="line">        en.setCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//4.创建子类(代理对象)</span></span><br><span class="line">        <span class="keyword">return</span> en.create();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始事务..."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行目标对象的方法</span></span><br><span class="line">        Object returnValue = method.invoke(target, args);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"提交事务..."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//目标对象</span></span><br><span class="line">        UserDao target = <span class="keyword">new</span> UserDao();</span><br><span class="line">        <span class="comment">//代理对象</span></span><br><span class="line">        UserDao proxy = (UserDao)<span class="keyword">new</span> ProxyFactory(target).getProxyInstance();</span><br><span class="line">        <span class="comment">//执行代理对象的方法</span></span><br><span class="line">        proxy.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本段落参考：<a href="https://www.cnblogs.com/cenyu/p/6289209.html" target="_blank" rel="noopener">Java的三种代理模式</a></p>
<h4 id="门面模式"><a href="#门面模式" class="headerlink" title="门面模式"></a>门面模式</h4><p>门面模式(外观模式)简单说就是隐藏了系统的复杂性，把一些复杂的流程封装成一个简单的接口让外部用户更简单的使用。门面模式中涉及3个角色：</p>
<ul>
<li>门面角色：外观模式的核心。它被客户角色调用，它熟悉子系统的功能。内部根据客户角色的需求预定了几种功能的组合。</li>
<li>子系统角色:实现了子系统的功能。它对客户角色和Facade时未知的。它内部可以有系统内的相互交互，也可以由供外界调用的接口。</li>
<li>客户角色:通过调用Facede来完成要实现的功能。</li>
</ul>
<p>看一个例子，以计算机启动为例，将一系列CPU、内存、硬盘的启动放到一个总的启动方法里，<strong>用户只需要调用该方法而不需要知道计算机内部的具体启动流程。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Computer.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    CPU cpu;</span><br><span class="line">    Disk dis;</span><br><span class="line">    Memory memory;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Computer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cpu = <span class="keyword">new</span> CPU();</span><br><span class="line">        dis = <span class="keyword">new</span> Disk();</span><br><span class="line">        memory = <span class="keyword">new</span> Memory();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Computer start begin---------"</span>);</span><br><span class="line">        cpu.start();</span><br><span class="line">        dis.start();</span><br><span class="line">        memory.start();</span><br><span class="line">        System.out.println(<span class="string">"Computer start end---------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Computer shutdown begin---------"</span>);</span><br><span class="line">        cpu.shutdown();</span><br><span class="line">        dis.shutdown();</span><br><span class="line">        memory.shutdown();</span><br><span class="line">        System.out.println(<span class="string">"Computer shutdown end---------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CPU.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CPU</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"CPU"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(TAG + <span class="string">" start"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(TAG + <span class="string">" shutdown"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Disk.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Disk</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"Disk"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(TAG + <span class="string">" start"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(TAG + <span class="string">" shutdown"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Memory.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Memory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"Memory"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(TAG + <span class="string">" start"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(TAG + <span class="string">" shutdown"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Computer computer = <span class="keyword">new</span> Computer();</span><br><span class="line">        computer.start();</span><br><span class="line">        computer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;&gt;输出：</span><br><span class="line">Computer start begin---------</span><br><span class="line">CPU start</span><br><span class="line">Disk start</span><br><span class="line">Memory start</span><br><span class="line">Computer start end---------</span><br><span class="line">Computer shutdown begin---------</span><br><span class="line">CPU shutdown</span><br><span class="line">Disk shutdown</span><br><span class="line">Memory shutdown</span><br><span class="line">Computer shutdown end---------</span><br></pre></td></tr></table></figure>

<h4 id="建造者模式-Builder"><a href="#建造者模式-Builder" class="headerlink" title="建造者模式(Builder)"></a>建造者模式(Builder)</h4><p>建造者模式在Java中很常见，通常在某各类的构造方法有很多参数，且参数后期可能还会增加的情况下使用。<strong>核心思想就是使用一个Builder来实现动态添加一个参数/配置项，返回自身对象。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rocket</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> spead;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> weight;</span><br><span class="line">    <span class="keyword">private</span> String dest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rocket</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = builder.name;</span><br><span class="line">        <span class="keyword">this</span>.spead = builder.spead;</span><br><span class="line">        <span class="keyword">this</span>.weight = builder.weight;</span><br><span class="line">        <span class="keyword">this</span>.dest = builder.dest;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSpead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> spead;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//建造者</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> spead;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> weight;</span><br><span class="line">        <span class="keyword">private</span> String dest;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">spead</span><span class="params">(<span class="keyword">int</span> spead)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.spead = spead;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">weight</span><span class="params">(<span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.weight = weight;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">dest</span><span class="params">(String dest)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.dest = dest;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Rocket <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Rocket(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rocket rocket = <span class="keyword">new</span> Rocket.Builder().name(<span class="string">"BlueStar"</span>).spead(<span class="number">1000</span>).weight(<span class="number">2200</span>).dest(<span class="string">"moon"</span>).build();</span><br></pre></td></tr></table></figure>

<h4 id="未完待续。。。"><a href="#未完待续。。。" class="headerlink" title="未完待续。。。"></a>未完待续。。。</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/28/Java%E3%80%8E%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%8F/" data-id="ck85a4u5n004dtw267flp7qms" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-开源项目——OkHttp『基础使用』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/28/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94OkHttp%E3%80%8E%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E3%80%8F/" class="article-date">
  <time datetime="2019-04-28T02:49:52.000Z" itemprop="datePublished">2019-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/28/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94OkHttp%E3%80%8E%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E3%80%8F/">OKHttp3『使用』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h4><p>OKHttp是一个高效的开源网络请求类库，具有以下特性：</p>
<ul>
<li>支持HTTP/2，<strong>允许所有同一个主机地址的请求共享同一个socket连接</strong></li>
<li>使用连接池，提高请求效率</li>
<li>透明的GZIp压缩减少响应数据的大小</li>
<li>缓存响应数据，避免一些完全重复的请求</li>
<li>当网络出现状态时，OKHTTP会进行尝试，如果服务有多个地址，OKHTTP会进行不同地址的请求尝试；<strong>注意，这里的重试指的是网络连接失败时的重试，而读取超时，连接超时不在范围内！</strong></li>
</ul>
<h4 id="二、配置环境"><a href="#二、配置环境" class="headerlink" title="二、配置环境"></a>二、配置环境</h4><h5 id="网络权限"><a href="#网络权限" class="headerlink" title="网络权限"></a>网络权限</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span>/&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span>/&gt;</span><br></pre></td></tr></table></figure>

<h5 id="类库依赖"><a href="#类库依赖" class="headerlink" title="类库依赖"></a>类库依赖</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">api <span class="string">'com.squareup.okhttp3:okhttp:3.10.0'</span></span><br><span class="line">api <span class="string">'com.squareup.okio:okio:1.14.0'</span></span><br></pre></td></tr></table></figure>

<h4 id="三、基础使用"><a href="#三、基础使用" class="headerlink" title="三、基础使用"></a>三、基础使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个OKHttpClient对象</span></span><br><span class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"><span class="comment">//创建一个Request</span></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">  .url(<span class="string">"https://api.github.com/users/jitmaos"</span>)</span><br><span class="line">  .addHeader(<span class="string">"key"</span>,<span class="string">"value"</span>)</span><br><span class="line">  .get()</span><br><span class="line">  .build();</span><br><span class="line"><span class="comment">//使用request，同步请求会返回一个Response，异步请求会回调成功、失败函数</span></span><br><span class="line">Response response = okHttpClient.newCall(request).execute();</span><br><span class="line">Log.d(TAG,response.body().string());</span><br></pre></td></tr></table></figure>

<h4 id="三、常用请求"><a href="#三、常用请求" class="headerlink" title="三、常用请求"></a>三、常用请求</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get请求</span></span><br><span class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"><span class="comment">//创建一个Request</span></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">  .url(<span class="string">"https://api.github.com/users/JakeWharton"</span>)</span><br><span class="line">  .get()</span><br><span class="line">  .build();</span><br><span class="line">okHttpClient.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">    Log.d(TAG,e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Log.d(TAG,response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Post提交表单</span></span><br><span class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"><span class="comment">//创建一个Request</span></span><br><span class="line">RequestBody requestBody = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">  .add(<span class="string">"key"</span>,<span class="string">"value"</span>)</span><br><span class="line">  .build();</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">  .url(<span class="string">"https://api.github.com/users/JakeWharton"</span>)</span><br><span class="line">  .post(requestBody)</span><br><span class="line">  .build();</span><br><span class="line">okHttpClient.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">    Log.d(TAG,e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Log.d(TAG,response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//Post提交文件</span></span><br><span class="line">MediaType mediaType = MediaType.parse(<span class="string">"text/x-markdown; charset=utf-8"</span>);</span><br><span class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"test.md"</span>);</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">  .url(<span class="string">"https://api.github.com/markdown/raw"</span>)</span><br><span class="line">  .post(RequestBody.create(mediaType, file))</span><br><span class="line">  .build();</span><br><span class="line">okHttpClient.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">    Log.d(TAG, <span class="string">"onFailure: "</span> + e.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Log.d(TAG, response.protocol() + <span class="string">" "</span> +response.code() + <span class="string">" "</span> + response.message());</span><br><span class="line">    Headers headers = response.headers();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; headers.size(); i++) &#123;</span><br><span class="line">      Log.d(TAG, headers.name(i) + <span class="string">":"</span> + headers.value(i));</span><br><span class="line">    &#125;</span><br><span class="line">    Log.d(TAG, <span class="string">"onResponse: "</span> + response.body().string());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="四、拦截器"><a href="#四、拦截器" class="headerlink" title="四、拦截器"></a>四、拦截器</h3><p>拦截器分为应用拦截器和网络拦截器</p>
<h5 id="应用拦截器"><a href="#应用拦截器" class="headerlink" title="应用拦截器"></a>应用拦截器</h5><ul>
<li>不用关心中间过程的响应，如重定向和重试</li>
<li>总是只调用一次，即使HTTP响应式从缓存中获取的</li>
<li>观察应用程序的初衷，不关心OKHTTP注入的头信息，如If-None-Match</li>
<li>允许短路，而且不用调用Chain.proceed()</li>
<li>允许重试，使得Chain.proceed()可以调用多次</li>
</ul>
<h5 id="网路拦截器"><a href="#网路拦截器" class="headerlink" title="网路拦截器"></a>网路拦截器</h5><ul>
<li>能够操作中间过程的响应，如重定向和重试</li>
<li>当网络短路不会调用缓存响应</li>
<li>只观察网络上传输的数据</li>
<li>访问包含请求信息的连接</li>
</ul>
<h5 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggingInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"LoggingInterceptor"</span>;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Request request = chain.request();</span><br><span class="line">    <span class="keyword">long</span> startTime = System.nanoTime();</span><br><span class="line">    Log.d(TAG, String.format(<span class="string">"Sending request %s on %s%n%s"</span>,</span><br><span class="line">                             request.url(), chain.connection(), request.headers()));</span><br><span class="line">    Response response =  chain.proceed(request);</span><br><span class="line">    <span class="keyword">long</span> endTime = System.nanoTime();</span><br><span class="line">    Log.d(TAG, String.format(<span class="string">"Received response for %s in %.1fms%n%s"</span>,</span><br><span class="line">       response.request().url(), (endTime - startTime) / <span class="number">1e6</span>d, response.headers()));</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h5 id="缓存响应"><a href="#缓存响应" class="headerlink" title="缓存响应"></a>缓存响应</h5><p>本段参考：<a href="https://www.jianshu.com/p/25e89116847c" target="_blank" rel="noopener">OkHttp3-使用进阶</a></p>
<p>要缓存响应数据，首先需要指定一个可以<strong>读写并确定大小的缓存目录</strong>，OKHttp会根据响应头的配置信息对数据进行缓存。服务器会在返回的响应数据中配置这个数据缓存多久的信息，如：Cache-Control:max-age=10000。我们也可以在请求头中添加自定义的缓存有效时间信息，如：Cache-control:max-stale=3600。<strong>可以通过Cache Control.FORCE_NETWORK指定不使用缓存直接从网络读取数据，也可以使用CacheControl.FORCE_CACHE指定不使用网络，直接从缓存读取数据。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OkHttpClient client;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CacheResponse</span><span class="params">(File cacheDirectory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> cacheSize = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 10 MiB</span></span><br><span class="line">  Cache cache = <span class="keyword">new</span> Cache(cacheDirectory, cacheSize);</span><br><span class="line"></span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">    .cache(cache)</span><br><span class="line">    .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">    .url(<span class="string">"http://publicobject.com/helloworld.txt"</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">  Response response1 = client.newCall(request).execute();</span><br><span class="line">  <span class="keyword">if</span> (!response1.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response1);</span><br><span class="line"></span><br><span class="line">  String response1Body = response1.body().string();</span><br><span class="line">  System.out.println(<span class="string">"Response 1 response:          "</span> + response1);</span><br><span class="line">  System.out.println(<span class="string">"Response 1 cache response:    "</span> + response1.cacheResponse());</span><br><span class="line">  System.out.println(<span class="string">"Response 1 network response:  "</span> + response1.networkResponse());</span><br><span class="line"></span><br><span class="line">  Response response2 = client.newCall(request).execute();</span><br><span class="line">  <span class="keyword">if</span> (!response2.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response2);</span><br><span class="line"></span><br><span class="line">  String response2Body = response2.body().string();</span><br><span class="line">  System.out.println(<span class="string">"Response 2 response:          "</span> + response2);</span><br><span class="line">  System.out.println(<span class="string">"Response 2 cache response:    "</span> + response2.cacheResponse());</span><br><span class="line">  System.out.println(<span class="string">"Response 2 network response:  "</span> + response2.networkResponse());</span><br><span class="line">  System.out.println(<span class="string">"Response 2 equals Response 1? "</span> + 					   response1Body.equals(response2Body));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="取消一个请求"><a href="#取消一个请求" class="headerlink" title="取消一个请求"></a>取消一个请求</h5><p>在Android中适时的取消一个请求是有必要的，比如当一个请求还在返回中，关闭了按钮，此时就应该及时的取消这个页面所有未完成的请求动作。</p>
<p> 服务器指定一个服务延时5秒执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">  System.out.println(System.currentTimeMillis() + <span class="string">"-收到请求"</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">new</span> BaseCURDOperator&lt;Book&gt;().search(<span class="keyword">this</span>,req,resp,<span class="keyword">null</span>,<span class="string">"id desc"</span>,<span class="keyword">null</span>, Book<span class="class">.<span class="keyword">class</span>,<span class="title">true</span>)</span>;</span><br><span class="line">  System.out.println(System.currentTimeMillis() + <span class="string">"-完成处理"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Android端测试取消请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">val executor = Executors.newScheduledThreadPool(<span class="number">1</span>)</span><br><span class="line">val client = OkHttpClient()</span><br><span class="line">  object:Thread()&#123;</span><br><span class="line">    <span class="function">override fun <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.run()</span><br><span class="line">        val request = Request.Builder()</span><br><span class="line">        .url(<span class="string">"http://192.168.1.6:8080/TP_S/BookList"</span>) <span class="comment">// 服务器延时了5秒返回数据</span></span><br><span class="line">        .build()</span><br><span class="line">        val call = client.newCall(request)</span><br><span class="line">        <span class="comment">// 1秒后取消请求</span></span><br><span class="line">        executor.schedule(Runnable &#123; call.cancel() &#125;, <span class="number">1</span>, TimeUnit.SECONDS)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          val response = call.execute()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">          <span class="comment">//取消请求后，再尝试去拿response，报Socket closed，说明请求被取消了</span></span><br><span class="line">          e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;.start()</span><br></pre></td></tr></table></figure>

<p>参考：<a href="https://blog.csdn.net/dingshuhong_/article/details/80335499" target="_blank" rel="noopener">OkHttp3最佳入门使用</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/28/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94OkHttp%E3%80%8E%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E3%80%8F/" data-id="ck85a4u5q004ntw260m0edt3e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-开源项目——RxJava2『使用』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/14/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E4%BD%BF%E7%94%A8%E3%80%8F/" class="article-date">
  <time datetime="2019-04-13T23:39:43.000Z" itemprop="datePublished">2019-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/14/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E4%BD%BF%E7%94%A8%E3%80%8F/">RxJava2『使用』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h4><p><strong>RxJava是一个在基于Java VM扩展的使用可观测的序列来组成异步的、基于事件的程序的库。</strong>它基于观察者模式支持数据和事件的流式流通处理，并增加了多种运算符以在多种场景下整合事件和数据。抽象了低级别的线程、同步、并发API。</p>
<ul>
<li><strong>响应式编程</strong>(Reactive Programming)是一种面向数据流和变化传播的编程范式。这意味着可以在编程语言中很方便地表达静态或动态的数据流，而相关的计算模型<strong>会自动将变化的值通过数据流进行传播</strong>。</li>
<li><strong>函数式编程</strong>是也一种编程范式，它将函数视为一等公民，意味着函数和其他类型数据有同等的地位，可以作为函数的参数、返回值使用(高阶函数)。</li>
<li>被观察者，Observable/Flowable</li>
<li>观察者，Observer/Consumer/Subscriber</li>
<li>上游：发射事件的地方，对应的是被订阅者(Observable/Flowable)</li>
<li>下游：接收事件的地方，对应的是观察者(Observer/Subscriber)</li>
</ul>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="1-创建被观察者-上游对象，Observable-Flowable"><a href="#1-创建被观察者-上游对象，Observable-Flowable" class="headerlink" title="1. 创建被观察者(上游对象，Observable/Flowable)"></a>1. 创建被观察者(上游对象，Observable/Flowable)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable&lt;String&gt; observable = Observable.fromArray(<span class="keyword">new</span> String[]&#123;<span class="string">"A"</span>,<span class="string">"B"</span>,<span class="string">"C"</span>&#125;);</span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/2019/04/14/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E4%BD%BF%E7%94%A8%E3%80%8F/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/14/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E4%BD%BF%E7%94%A8%E3%80%8F/" data-id="ck85a4u5u004utw26fyeyhdju" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RxJava2/" rel="tag">RxJava2</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-开源项目——RxJava2『原理』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/13/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E5%8E%9F%E7%90%86%E3%80%8F/" class="article-date">
  <time datetime="2019-04-13T00:23:19.000Z" itemprop="datePublished">2019-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/13/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E5%8E%9F%E7%90%86%E3%80%8F/">RxJava2『原理』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>####考虑如何使用RxJava</p>
<ul>
<li><p>创建Observable</p>
<p>要创建一个Observable可以通过create()自定义Observable行为的方式；或者通过操作符(比如：from、just)将现有的数据对象转换成一个Observable。</p>
</li>
<li><p>使用操作符转换Observable</p>
<p>RxJava允许你通过串联操作符的方式来转换Observable或者合并多个Observable</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/13/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94RxJava2%E3%80%8E%E5%8E%9F%E7%90%86%E3%80%8F/" data-id="ck85a4u5s004stw2618kydlfs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『性能优化』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/10/Android%E3%80%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E3%80%8F/" class="article-date">
  <time datetime="2019-04-09T22:23:32.000Z" itemprop="datePublished">2019-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/10/Android%E3%80%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E3%80%8F/">Android『性能优化』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>APP优化主要分为4个类别，分别是流畅、稳定、省电省流量、安装包大小</p>
<h4 id="流畅度"><a href="#流畅度" class="headerlink" title="流畅度"></a>流畅度</h4><ul>
<li><p>常见问题</p>
</li>
<li><p>检测工具</p>
</li>
<li><p>优化</p>
<ul>
<li><p>局部刷新</p>
<ul>
<li><p>RecyclerView的局部刷新</p>
<p>一般就两种做法：第一种就是通过recyclerview的findViewHolderForAdapterPosition方法找到那个item所在的viewholder直接拿到viewholder进行操作，不过这种方法存在弊端，就是只能获取当前屏幕所显示的viewholder,如果不在当前屏幕那就会获取的是一个null。所以在使用的时候应该通过manager.findFirstVisibleItemPosition()和manager.findLastVisibleItemPosition()判断要改变的item的position是否在这区间内。第二种方式通过layoutManager.findViewByPosition()获取view 注意的地方也是和第一种一样。</p>
<p>notifyItemChanged(logPosition,”test”).第二个参数任意类型的参数，还需要在适配器中重写onBindViewHolder(VH holder, int position, List<Object> payloads)方法，第三个参数大小只有1.它的值就是我们之前传入的“test”。</p>
</li>
</ul>
</li>
<li><p>APP启动方式</p>
</li>
</ul>
</li>
</ul>
<h4 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h4><ul>
<li>问题描述</li>
<li>性能分析</li>
<li>Java内存相关</li>
<li>其他优化<ul>
<li>对象及时销毁，资源及时释放</li>
<li>请求及时取消，LifeCycle</li>
<li></li>
</ul>
</li>
</ul>
<p>内存溢出</p>
<ul>
<li>定义</li>
<li></li>
<li>游湖方式</li>
</ul>
<p>内存泄漏</p>
<ul>
<li>定义</li>
<li>常见场景</li>
<li>优化方式</li>
</ul>
<p>资源优化</p>
<ul>
<li></li>
</ul>
<p>用户体验优化</p>
<ul>
<li>启动优化</li>
<li>加载对话框</li>
<li>防止重复提交、抖动</li>
<li></li>
</ul>
<p>参考：<a href="https://blog.csdn.net/u011240877/article/details/54347396" target="_blank" rel="noopener">Android 性能优化：使用 TraceView 找到卡顿的元</a></p>
<p><a href="https://www.cnblogs.com/cr330326/p/8011523.html" target="_blank" rel="noopener">https://www.cnblogs.com/cr330326/p/8011523.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/10/Android%E3%80%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E3%80%8F/" data-id="ck85a4u4x0031tw263vkod9gs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android『小知识点』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/09/Android%E3%80%8E%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E3%80%8F/" class="article-date">
  <time datetime="2019-04-09T11:41:37.000Z" itemprop="datePublished">2019-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/09/Android%E3%80%8E%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E3%80%8F/">Android『小知识点』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h5 id="HanderThread"><a href="#HanderThread" class="headerlink" title="HanderThread"></a>HanderThread</h5><p>一个包含一个looper的<strong>线程</strong>，这个looper可以用来创建hanlder，需要注意start()方法还是需要调用才能使用。</p>
<p>HandlerThread有<strong>quit()和quitSafely()</strong>方法用于退出HandlerThread对应的Looper，其实应该是直接调用了Looper.quit()和Looper.quitSafely()，<strong>后者自API 18</strong>添加。除此之外，还有其他方法：</p>
<p><strong>getLooper()：该方法是同步的，如果线程已经启动了，那么这个方法会在looper初始化完成之前保持阻塞。</strong></p>
<h5 id="SharePreferences"><a href="#SharePreferences" class="headerlink" title="SharePreferences"></a>SharePreferences</h5><p>提交修改可以使用apply()和commit()，两者是不同的，具体：</p>
<ol>
<li><p>commit是同步的，会返回一个执行成功与否的boolean结果；apply是异步的，提交以后直接改变内容中的值，然后返回，将入数据写入磁盘的动作放到异步线程里进行，不返回成功与否的boolean结果。</p>
</li>
<li><p>如果你不在乎数据写入的结果，而且又位于主线程中，那么apply比较合适，因为比较快。反之，如果存在则使用commit比较合适。</p>
</li>
</ol>
<h5 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h5><p>IntentService是一个用来处理异步请求的的类，通过startService(Intent)启动，所有的Intent会在一个<strong>工作线程按顺序处理</strong>。工作队列处理器模式一般用来处理从application的主线程卸下的任务。IntentService的存在只是为了简化工作，IntentService是抽象类，集成它并实现onHandleIntent方法，IntentService接收到Intent，并启动一个线程。<strong>所有的请求Intent都会被一个工作线程处理，会处理直到所有任务都完成，注意每次只能处理一个请求。</strong></p>
<h5 id="FragmentTranscation"><a href="#FragmentTranscation" class="headerlink" title="FragmentTranscation"></a>FragmentTranscation</h5><p>用于保证一些列Fragment操作的原子性。</p>
<ol>
<li>transaction.add() //往Activity中添加一个Fragment</li>
<li>transaction.remove() //从Activity中移除一个Fragment</li>
<li>transaction.replace() //先remove在add的组合操作</li>
<li>transaction.hide() //隐藏当前Fragment，仅仅设为不可见，并不会销毁</li>
<li>transaction.show() //显示之前隐藏的Fragment</li>
</ol>
<h5 id="AsyncQueryHandler"><a href="#AsyncQueryHandler" class="headerlink" title="AsyncQueryHandler"></a>AsyncQueryHandler</h5><p>AsyncQueryHandler是用于在ContentProvider上面执行<font color="#dd0000"><strong>异步的CRUD</strong></font>操作的工具类，CRUD操作通常会被放到一个<strong>单独的子线程</strong>中执行，当操作结束获取结果后，将通过消息的方式传递给调用AsyncQueryHandler的线程，通常就是主线程。AsyncQueryHandler是一个抽象类，继承自Handler。通过封装ContentResolver、HandlerThread、Handler等实现对ContentProvider的异步操作。</p>
<h5 id="JobService"><a href="#JobService" class="headerlink" title="JobService"></a>JobService</h5><p>在Android 5.0中引入<strong>JobScheduler</strong>来执行一些<strong>需要满足特定条件但不紧急的后台任务</strong>，当一系列预置的条件被满足时，JobScheduler API为你的应用执行一个操作，jobScheduler API允许同时执行多个任务。这允许你的应用执行某些指定的任务时不需要考虑时机控制引起的电池消耗。<font color="#dd0000"><strong>JobScheduler是一个系统级的作业调度器，我们将某些任务扔给系统，当达到我们设定的条件以后，JobScheduler再吊起我们的JobService执行我们的业务逻辑。</strong></font></p>
<h5 id="ComponentCallbacks和ComponentCallbacks2"><a href="#ComponentCallbacks和ComponentCallbacks2" class="headerlink" title="ComponentCallbacks和ComponentCallbacks2"></a>ComponentCallbacks和ComponentCallbacks2</h5><p>ComponentCallbacks定义了两个方法onConfigurationChanged()和onLowMemory()；<strong>ComponentCallbacks2是API14新增的类，添加了onTrimMemory()</strong>，<font color="#dd0000"><strong>当系统决定对某个进程进行内存优化时会回调到。</strong></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComponentCallbacks2</span> <span class="keyword">extends</span> <span class="title">ComponentCallbacks</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统正处于低内存状态，app进程是首先被杀进程之一，如果系统现在没有恢复内存，应该立即释放对app不重要的		 * 所有内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_COMPLETE = <span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统正处于低内存状态，app进程位于LRU List中部附近，如果系统进一步内存紧张，app进程可能会被杀掉</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_MODERATE = <span class="number">60</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统正处于低内存状态，app进程位于LRU List开始附近，尽管app进程被杀死的概率低，系统可能已经开始杀在			 * LRU List中的后台进程,此时应该释放一些资源，防止被杀的几率</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_BACKGROUND = <span class="number">40</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 你的用户界面不再可见，此时应该释放仅仅使用在UI上的大资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_UI_HIDDEN = <span class="number">20</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统处于极低的内存状态，app仍然不会被杀死。但如果不是放资源，系统开始杀后台进程，此时app应该清理一些		 * 资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_RUNNING_CRITICAL = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统处于更低内存状态，app正在运行且不会被杀死，可以释放不用的资源提升app性能</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_RUNNING_LOW = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统处于低内存状态，app正在运行且不会被杀死</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRIM_MEMORY_RUNNING_MODERATE = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当系统决定对一个进程的内存进行优化的时候调用会被调用。举个例子：在后台资源不够运行所需的进程时。你不应该将具体的数值和level做比较，因为后期可能会增加新的数值。你可以使用大于或等于某个你感兴趣的level。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 你可以通过ActivityManager.getMyMemoryState(RunningAppProcessInfo)获取到当前进程的内存优			 * 化等级。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> level 系统希望执行的内存清理等级</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onTrimMemory</span><span class="params">(<span class="keyword">int</span> level)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本段参考：<a href="https://www.jianshu.com/p/1bf70b535eb9" target="_blank" rel="noopener">https://www.jianshu.com/p/1bf70b535eb9</a></p>
<p>SP标记multi-process用于标记SP可以在多进程中访问，但是多进程访问SP会带来新问题：</p>
<p><a href="https://stackoverflow.com/questions/27827678/use-sharedpreferences-on-multi-process-mode" target="_blank" rel="noopener">Use SharedPreferences on multi-process mode</a></p>
<h5 id="hasMessage-int-what"><a href="#hasMessage-int-what" class="headerlink" title="hasMessage(int what)"></a>hasMessage(int what)</h5><p>Check if there are any pending posts of messages with code ‘what’ in the message queue.</p>
<h3 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h3><h5 id="获取当前进程名的方法一"><a href="#获取当前进程名的方法一" class="headerlink" title="获取当前进程名的方法一"></a>获取当前进程名的方法一</h5><p>在Linux系统中，根据进程号得到进程的命令行参数，常规的做法是读取<strong>/proc/{PID}/cmdline</strong>，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getProcessName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BufferedReader reader = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">"/proc/"</span> + Process.myPid() + <span class="string">"/cmdline"</span>));</span><br><span class="line">            String processName = reader.readLine();</span><br><span class="line">            <span class="keyword">if</span> (!TextUtils.isEmpty(processName)) &#123;</span><br><span class="line">                processName = processName.trim();</span><br><span class="line">            &#125;</span><br><span class="line">            String var2 = processName;</span><br><span class="line">            <span class="keyword">return</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var12) &#123;</span><br><span class="line">            var12.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (reader != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException var11) &#123;</span><br><span class="line">                var11.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><p><strong>查看Activity堆栈情况</strong>，会到的很长的输出内容，检索<strong>Running activities</strong>可以查看最近执行的Activity情况。</p>
<h5 id="AAR相关"><a href="#AAR相关" class="headerlink" title="AAR相关"></a>AAR相关</h5><h6 id="AAR-与-Jar"><a href="#AAR-与-Jar" class="headerlink" title="AAR 与 Jar"></a>AAR 与 Jar</h6><p>jar：<strong>只包含了class文件与清单文件 ，不包含资源文件，如图片等所有res中的文件。</strong></p>
<p>aar： <strong>Android库项目的二进制归档文件，包含所有资源，class以及res资源文件全部包含。</strong></p>
<p><strong>aar问题：</strong></p>
<p><font color="#dd0000"><strong>其实AAR只是把编译好的class文件和资源文件打包成一个二进制的包</strong></font>，打包后会<font color="#dd0000"><strong>丢失依赖</strong></font>，所以引用AAR时，不存在重复依赖的问题，需要同时引入AAR包中用到的类文件才能正确编译。</p>
<ol>
<li>资源文件不能同名,大量改动 </li>
<li>*<em>Application需要主APP传递给AAR，AAR再做单例模式 *</em></li>
<li>扫描模块需要AAR自己初始化 </li>
<li>jar尽量用maven，如果是本地的libs，需要exlude so和provided jar </li>
<li>AAR可以通过主APP的application初始化自己的数据库 </li>
<li>轻量数据，可以用intent启动AAR的时候传递 </li>
<li>如果有基础数据需要提供服务，可以用contentProvider </li>
<li>butterknife需要统一用8.4.0以上的版本，不然报错 </li>
<li>AAR模块用butterknife需要把资源R改为R2(批量替换)</li>
</ol>
<h5 id="AndroidManifest-xml"><a href="#AndroidManifest-xml" class="headerlink" title="AndroidManifest.xml"></a>AndroidManifest.xml</h5><ul>
<li><p>android:exported = true</p>
<p>在Activity中该属性用来标示：<strong>当前Activity是否可以被另一个Application的组件启动：true允许被启动；false不允许被启动。</strong>android:exported 是Android中的四大组件 Activity，Service，Provider，Receiver 四大组件中都会有的一个属性。总体来说它的主要作用是：是否支持其它应用调用当前组件</p>
</li>
<li><p>android:enabled=”true”</p>
<p>这个属性用于指示该服务是否能够被实例化。如果设置为true，则能够被实例化，否则不能被实例化。默认值是true。    </p>
</li>
<li><p>android:permission</p>
<p>这个属性定义了要启动或绑定服务的实体必须要有的权限。<strong>如果调用者的startService()、bindService()和stopService()方法没有被授予这个权限，那么这些方法就不会工作，并且Intent对象也不会发送给改服务。</strong>如果这个属性没被设置，<strong>那么通过&lt;appliction&gt;元素的permission属性所设定的权限就会适用于该服务。</strong>如果&lt;application&gt;元素也没有设置权限，则该服务不受权限保护。</p>
</li>
</ul>
<h5 id="数据压缩"><a href="#数据压缩" class="headerlink" title="数据压缩"></a>数据压缩</h5><h6 id="GZIP"><a href="#GZIP" class="headerlink" title="GZIP"></a>GZIP</h6><p>GZIP是网站压缩加速的一种技术，对于开启后可以加快我们网站的打开速度，原理是经过服务器压缩，客户端浏览器快速解压的原理，可以大大减少了网站的流量。<strong>一般对纯文本内容可压缩到原大小的40％</strong>。</p>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><ol>
<li>模拟器访问本地Tomcat地址为：<font color="#dd0000"><strong>10.0.2.2</strong></font></li>
</ol>
<h5 id="AndroidJUnit4单元测试"><a href="#AndroidJUnit4单元测试" class="headerlink" title="AndroidJUnit4单元测试"></a>AndroidJUnit4单元测试</h5><h6 id="获取Context"><a href="#获取Context" class="headerlink" title="获取Context"></a>获取Context</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InstrumentationRegistry.getInstrumentation().getTargetContext()</span><br></pre></td></tr></table></figure>

<h5 id="ADB相关"><a href="#ADB相关" class="headerlink" title="ADB相关"></a>ADB相关</h5><h6 id="adb-install-multiple-命令"><a href="#adb-install-multiple-命令" class="headerlink" title="adb install-multiple 命令"></a>adb install-multiple 命令</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb install [-lrtsdg] (file)</span><br><span class="line">-l 锁定应用</span><br><span class="line">-r 替换已存在的应用</span><br><span class="line">-t 允许安装测试包</span><br><span class="line">-s 安装到sd卡中</span><br><span class="line">-d 可以安装低版本安装包</span><br><span class="line">-p 安装部分应用</span><br><span class="line">-g 授权所有运行时权限</span><br></pre></td></tr></table></figure>

<h6 id="adb-uninstall-k-package"><a href="#adb-uninstall-k-package" class="headerlink" title="adb uninstall [-k] (package)"></a>adb uninstall [-k] (package)</h6><p>卸载安装包</p>
<h6 id="adb-shell-dumpsys-activity-activities"><a href="#adb-shell-dumpsys-activity-activities" class="headerlink" title="adb shell dumpsys activity activities"></a>adb shell dumpsys activity activities</h6><h3 id="兼容性API"><a href="#兼容性API" class="headerlink" title="兼容性API"></a>兼容性API</h3><h5 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h5><ul>
<li><p>动态设置按钮点击效果</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> wrappedDrawable = DrawableCompat.wrap(drawable)</span><br><span class="line">DrawableCompat.setTintList(wrappedDrawable, ColorStateList.valueOf(colors))</span><br><span class="line">setImageDrawable(wrappedDrawable)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>getColor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ContextCompat.getColor(context, R.color.text_black)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><h5 id="Google-Protocol-Buffer"><a href="#Google-Protocol-Buffer" class="headerlink" title="Google Protocol Buffer"></a>Google Protocol Buffer</h5><p>一般项目中多使用JSON作为数据传递和解析的格式，但实际上有其他的的传输格式比JSON有更优秀的效率、体积上的表现，比如Google出品的ProtocolBuffer，比起JSON来说具有更小、更快、使用更简单等特点，具体介绍可以查看这篇博客：<a href="https://www.cnblogs.com/xinmengwuheng/p/7070393.html" target="_blank" rel="noopener">快来看看Google出品的Protocol Buffer，别只会用Json和XML了</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/09/Android%E3%80%8E%E5%B0%8F%E7%9F%A5%E8%AF%86%E7%82%B9%E3%80%8F/" data-id="ck85a4u4w002ytw264bvd9ju7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android『Binder机制』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/09/Android%E3%80%8EBinder%E6%9C%BA%E5%88%B6%E3%80%8F/" class="article-date">
  <time datetime="2019-04-09T11:34:34.000Z" itemprop="datePublished">2019-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/09/Android%E3%80%8EBinder%E6%9C%BA%E5%88%B6%E3%80%8F/">Android『Binder机制』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/09/Android%E3%80%8EBinder%E6%9C%BA%E5%88%B6%E3%80%8F/" data-id="ck85a4u4f002ktw26hgoe5mnw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『APP启动过程』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/09/Android%E3%80%8EAPP%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E3%80%8F/" class="article-date">
  <time datetime="2019-04-09T11:34:13.000Z" itemprop="datePublished">2019-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/09/Android%E3%80%8EAPP%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E3%80%8F/">Android『APP启动过程』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/09/Android%E3%80%8EAPP%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E3%80%8F/" data-id="ck85a4u45002itw26aw1y30bq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AnnotationProcessor/" rel="tag">AnnotationProcessor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Framework/" rel="tag">Framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/" rel="tag">Retrofit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava2/" rel="tag">RxJava2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jni/" rel="tag">jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ndk/" rel="tag">ndk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%83%E5%B1%80%E7%9B%B8%E5%85%B3/" rel="tag">布局相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%EF%BC%8Cprotobuf/" rel="tag">数据转换，protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" rel="tag">源码学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" rel="tag">编程语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/AnnotationProcessor/" style="font-size: 10px;">AnnotationProcessor</a> <a href="/tags/Framework/" style="font-size: 10px;">Framework</a> <a href="/tags/Java/" style="font-size: 16.67px;">Java</a> <a href="/tags/Kotlin/" style="font-size: 10px;">Kotlin</a> <a href="/tags/Retrofit/" style="font-size: 10px;">Retrofit</a> <a href="/tags/RxJava2/" style="font-size: 13.33px;">RxJava2</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jni/" style="font-size: 10px;">jni</a> <a href="/tags/ndk/" style="font-size: 10px;">ndk</a> <a href="/tags/%E5%B8%83%E5%B1%80%E7%9B%B8%E5%85%B3/" style="font-size: 10px;">布局相关</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%EF%BC%8Cprotobuf/" style="font-size: 10px;">数据转换，protobuf</a> <a href="/tags/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">源码学习</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">编程语言</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.33px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 16.67px;">读书笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/03/19/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8EJava%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8F/">读书笔记『Java并发编程实战』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E3%80%8E%E8%85%BE%E8%AE%AFMMKV%E5%AD%98%E5%82%A8%E6%A1%86%E6%9E%B6%E3%80%8F/">开源项目『腾讯MMKV存储框架』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94OkHttp%E3%80%8E%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E3%80%8F/">OkHttp『源码学习-杂项』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/Java%E8%BF%9B%E9%98%B6%E3%80%8EJavassist%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%8F/">Java进阶『Javassist学习笔记』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/Java%E7%B1%BB%E5%BA%93%E5%AD%A6%E4%B9%A0%E3%80%8EProtocolBuffers%E3%80%8F/">Java类库学习『ProtocolBuffers』</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="http://cdn.bootcss.com/jquery/2.1.1/jquery.min.js“ > </script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>