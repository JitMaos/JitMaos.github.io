<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Android学习『插件化相关』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E5%AD%A6%E4%B9%A0%E3%80%8E%E6%8F%92%E4%BB%B6%E5%8C%96%E7%9B%B8%E5%85%B3%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.079Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E5%AD%A6%E4%B9%A0%E3%80%8E%E6%8F%92%E4%BB%B6%E5%8C%96%E7%9B%B8%E5%85%B3%E3%80%8F/">Android学习『插件化相关』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>学习源：<a href="https://www.bilibili.com/video/av76184565?from=search&amp;seid=11868282596475779796" target="_blank" rel="noopener">https://www.bilibili.com/video/av76184565?from=search&amp;seid=11868282596475779796</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E5%AD%A6%E4%B9%A0%E3%80%8E%E6%8F%92%E4%BB%B6%E5%8C%96%E7%9B%B8%E5%85%B3%E3%80%8F/" data-id="ck8qp09go003blz26ezvb9fce" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android学习『跨进程通信』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E5%AD%A6%E4%B9%A0%E3%80%8E%E8%B7%A8%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.079Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E5%AD%A6%E4%B9%A0%E3%80%8E%E8%B7%A8%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%E3%80%8F/">Android学习『跨进程通信』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、内核态和用户态"><a href="#一、内核态和用户态" class="headerlink" title="一、内核态和用户态"></a>一、内核态和用户态</h3><h4 id="1、内核态和用户态的简介"><a href="#1、内核态和用户态的简介" class="headerlink" title="1、内核态和用户态的简介"></a>1、内核态和用户态的简介</h4><blockquote>
<ul>
<li><strong>内核态</strong>：CPU可以访问内存所有数据，包括外围设备，例如硬盘、网卡，CPU可以将自己从一个程序切换到另外一个程序。</li>
<li><strong>用户态</strong>:   <font color="#dd0000"><strong>只能受限的访问内存，且不允许访问外围设备，占用CPU的能力被剥削，CPU资源可以被其他程序获取</strong></font>。</li>
</ul>
</blockquote>
<h4 id="2、为什么要有用户态和内核态"><a href="#2、为什么要有用户态和内核态" class="headerlink" title="2、为什么要有用户态和内核态"></a>2、为什么要有用户态和内核态</h4><blockquote>
<p>由于需要限制不同的程序之间的访问能力，防止他们获取别的程序的内存数据，或者获取外围设备的数据，并发送网络，CPU划分出两个权限等级  —-用户态  和  内核态。</p>
</blockquote>
<h4 id="3、用户态与内核态的切换"><a href="#3、用户态与内核态的切换" class="headerlink" title="3、用户态与内核态的切换"></a>3、用户态与内核态的切换</h4><h5 id="3-1-切换简介"><a href="#3-1-切换简介" class="headerlink" title="3.1 切换简介"></a>3.1 切换简介</h5><p>所有用户程序都是运行在用户态的，但是有时候程序确实需要做一些内核态的事情，例如从硬盘读取数据，或者从键盘获取输入等。而唯一可以这这些事情的就是 <strong>操作系统</strong> ，所以这时候 <strong>程序</strong> 就需要先向 <strong>操作系统</strong> 请求，以 <strong>程序</strong> 的名字来执行这些操作。这时候就需要一个这样的机制：用户态 切换到 内核态，但是不能控制内核态中执行的执行这种机制叫做** 系统调用 **，在CPU中的实现称之为 “陷阱指令(Trap Instruction)”</p>
<h5 id="3-2-系统调用机制流程："><a href="#3-2-系统调用机制流程：" class="headerlink" title="3.2 系统调用机制流程："></a>3.2 系统调用机制流程：</h5><blockquote>
<ul>
<li>1、用户态程序将一些数据值放在寄存器中，或者使用参数创建一个堆栈(stack frame)，以表明需要操作系统提供的服务。</li>
<li>2、用户态程序执行陷阱指令</li>
<li>3、CUP切换到内核态，并跳到内存指定位置的指令，这些指令是操作系统的一部分，他们具有内存保护，不可被用户态程序访问</li>
<li>4、这些指令称之为 陷阱 (trap) 或者新系统调用处理器 ( system call hanlder )。他们会读取程序放入内存的数据参数，并执行程序请求的服务。</li>
<li>5、系统调用完成后，操作系统会重置CPU为用户态并返回系统调用的结果。</li>
</ul>
</blockquote>
<h3 id="二、红黑树"><a href="#二、红黑树" class="headerlink" title="二、红黑树"></a>二、红黑树</h3><p>红黑树，顾名思义，红黑树的节点是有颜色概念的，即非红即黑，通过颜色的语速，红黑树为支持着二叉搜索树的平衡性。一个红黑树必须有下面5个特征</p>
<blockquote>
<ul>
<li>1、节点是红色或黑色</li>
<li>2、根是黑色</li>
<li>3、所有叶子是黑色(叶子是NIL节点)</li>
<li>4、每个红色节点的两个子节点都是黑色的(从每个叶子到跟的所有路径不能有两个连续的红色节点)</li>
<li>5、从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点。</li>
</ul>
</blockquote>
<p>这些特征强制约束了红黑树的关键性质：从跟到叶子的最长可能路径不多于最短可能路径的两倍长(特征4保证了路径最长的情况为1红1黑，最短的情况为全黑，再结合特征5，可以推导出)。<strong>结果是这个树大致上是平衡的</strong>。因为比如插入、删除和查找操作中，操作某个值的最坏情况的时间都要求与树的高度成比例，<font color="#dd0000"><strong>这个高度上的理论上限允许红黑树在最坏的情况都是高效的，而不同于普通的(二叉搜索树)</strong></font></p>
<h3 id="三、Linux的跨进程通信-IPC-概述"><a href="#三、Linux的跨进程通信-IPC-概述" class="headerlink" title="三、Linux的跨进程通信(IPC)概述"></a>三、Linux的跨进程通信(IPC)概述</h3><h4 id="1-跨进程通信-IPC-的目的"><a href="#1-跨进程通信-IPC-的目的" class="headerlink" title="1.跨进程通信(IPC)的目的"></a>1.跨进程通信(IPC)的目的</h4><p>跨进程通信(IPC)的目的主要如下：</p>
<blockquote>
<ul>
<li>数据传递<br> 一个进程需要将它的数据发送给另外一个进程，发送的数据量在一个字节到几M字节之间</li>
<li>共享数据<br> 多个进程想要操作共享数据。</li>
<li>通知事件<br> 一个进程需要向另一个或一组进程发送消息，通知它(它们)发生了某种事件(如进程终止时要通知父进程)</li>
<li>资源共享<br> 多个进程之间共享资源。为了做到这一点，需要内核提供锁和同步机制</li>
<li>进程控制<br> 有些进程希望完全控制另一个进程的执行(如debug进程)，此时控制进程希望能够拦截另一个进程的所有步骤和异常，并能够及时知道它的状态改变。</li>
</ul>
</blockquote>
<h4 id="2-Linux-进程间通信-IPC-的发展"><a href="#2-Linux-进程间通信-IPC-的发展" class="headerlink" title="2.Linux 进程间通信(IPC)的发展"></a>2.Linux 进程间通信(IPC)的发展</h4><p>Linux中的进程间通信大体分为4类</p>
<blockquote>
<ul>
<li>基于早期Unix的进程间通信：管道和信号</li>
<li>基于System V的进程间通信：System V消息队列、System V 信号灯、System V 共享内存</li>
<li>基于Socket 的进程间通信：socket</li>
<li>POSIX进程间通信：posix 消息队列、posix信号灯、posix共享内存</li>
</ul>
</blockquote>
<h3 id="三、Android中进程通信的限制"><a href="#三、Android中进程通信的限制" class="headerlink" title="三、Android中进程通信的限制"></a>三、Android中进程通信的限制</h3><h4 id="1-静态成员和单利模式完全失效"><a href="#1-静态成员和单利模式完全失效" class="headerlink" title="1. 静态成员和单利模式完全失效"></a>1. 静态成员和单利模式完全失效</h4><p>Android系统为每一个应用分配了一个独立的虚拟机，或者说为每个进程都分配了一个独立的虚拟机，不同的虚拟机在内存上有不同的地址空间，这就导致在不同的虚拟机中访问同一个类对象会产生多分副本</p>
<h4 id="2-线程同步机制完全失效"><a href="#2-线程同步机制完全失效" class="headerlink" title="2. 线程同步机制完全失效"></a>2. 线程同步机制完全失效</h4><h4 id="3-SharedPreferences的可靠性下降"><a href="#3-SharedPreferences的可靠性下降" class="headerlink" title="3. SharedPreferences的可靠性下降"></a>3. SharedPreferences的可靠性下降</h4><p>因为SharePreference不支持两个进程同时去执行写操作，否则会导致一定几率的数据丢失，这是因为SharedPreferences底层是通过读/写XML文件来实现的，并发写显然会出问题的，甚至并发读/写都有可能出问题。</p>
<h4 id="4-Application会多次创建"><a href="#4-Application会多次创建" class="headerlink" title="4. Application会多次创建"></a>4. Application会多次创建</h4><p>当一个组件跑在一个新的进程中，由于系统要再创建新的进程同时分配独立的虚拟机，所以这个过程其实就是启动一个应用的过程。因此，相当于系统又把这个应用重新启动了一遍，既然重新启动了，那么自认会创建新的Applicatiaon。</p>
<h3 id="四、Serializable和Parcelable接口"><a href="#四、Serializable和Parcelable接口" class="headerlink" title="四、Serializable和Parcelable接口"></a>四、Serializable和Parcelable接口</h3><h4 id="1-Serializable接口"><a href="#1-Serializable接口" class="headerlink" title="1. Serializable接口"></a>1. Serializable接口</h4><h5 id="1-1-Serializable简介"><a href="#1-1-Serializable简介" class="headerlink" title="1.1 Serializable简介"></a>1.1 Serializable简介</h5><p>Serializable 是<font color="#dd0000"><strong>Java</strong></font>所提供的一个序列化接口，它是一个<font color="#dd0000"><strong>空接口</strong></font>，为对象提供标准的序列化和反序列化操作。</p>
<h5 id="1-2-SerialVersionUID的作用"><a href="#1-2-SerialVersionUID的作用" class="headerlink" title="1.2 SerialVersionUID的作用"></a>1.2 SerialVersionUID的作用</h5><blockquote>
<ul>
<li>这个serialVersionUID是用来辅助序列化和反序列化的过程。原则上序列化后的数据中的serialVersionUID只有和当前类的serialVersionUID一致才能成功的反序列化。</li>
<li>serialVersionUID的详细工作机制是这样的：序列化的时候系统会把当前类的serialVersionUID写入序列化的文件中(也可能是其他中介)，当反序列化的时候系统会去检测文件中的serialVersionUID，看它是否和当前类的serialVersionUID一致，如果一致就说明序列化的类的版本和当前类的版本是相同的，这个时候可以成功反序列化；否则就说明当前类和序列化的类相比发生了某些变换，比如成员变量的数量、类型可能会发生变化，这时候就无法正常的反序列化。会报如下错误:</li>
</ul>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">java</span><span class="selector-class">.io</span><span class="selector-class">.InvalidClassException</span></span><br></pre></td></tr></table></figure>

<h6 id="所以当我们手动制订了它之后，就可以很大程度上避免了泛学历化过程的失败。"><a href="#所以当我们手动制订了它之后，就可以很大程度上避免了泛学历化过程的失败。" class="headerlink" title="所以当我们手动制订了它之后，就可以很大程度上避免了泛学历化过程的失败。"></a>所以当我们手动制订了它之后，就可以很大程度上避免了泛学历化过程的失败。</h6><p>1、静态成员变量属于类，不属于对象，所以不会参与序列化的过程</p>
<p>2、用transient关键字编辑的成员变量不参与序列化的过程。</p>
<p>3、可以通过重写writeObject()和readObject()两个方法来重写系统默认的序列化和反序列化的过程。不过本人并不推荐</p>
<h4 id="2-Parcelable接口"><a href="#2-Parcelable接口" class="headerlink" title="2. Parcelable接口"></a>2. Parcelable接口</h4><p>Parcelable也是一个接口，只要实现了这个接口，一个类的对象就可以实现序列化和并且通过Intent和Binder传递。</p>
<p>参考：<a href="https://www.jianshu.com/p/36b488863bc0" target="_blank" rel="noopener">隔壁老李头的跨进程通信IPC系列</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E5%AD%A6%E4%B9%A0%E3%80%8E%E8%B7%A8%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1%E3%80%8F/" data-id="ck8qp09go003dlz261lal0qu3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『布局』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E3%80%8E%E5%B8%83%E5%B1%80%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.076Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E3%80%8E%E5%B8%83%E5%B1%80%E3%80%8F/">Android『布局相关』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ConstrainLayout"><a href="#ConstrainLayout" class="headerlink" title="ConstrainLayout"></a>ConstrainLayout</h3><h4 id="文本基线-BaseLine-对齐"><a href="#文本基线-BaseLine-对齐" class="headerlink" title="文本基线(BaseLine)对齐"></a>文本基线(BaseLine)对齐</h4><h4 id="不可见时增加margin的-layout-goneMargin"><a href="#不可见时增加margin的-layout-goneMargin" class="headerlink" title="不可见时增加margin的(layout_goneMargin)"></a>不可见时增加margin的(layout_goneMargin)</h4><h4 id="基于角度和距离的定位"><a href="#基于角度和距离的定位" class="headerlink" title="基于角度和距离的定位"></a>基于角度和距离的定位</h4><h4 id="增加偏移量"><a href="#增加偏移量" class="headerlink" title="增加偏移量"></a>增加偏移量</h4><h4 id="设置组件宽高比"><a href="#设置组件宽高比" class="headerlink" title="设置组件宽高比"></a>设置组件宽高比</h4><h4 id="Barrier"><a href="#Barrier" class="headerlink" title="Barrier"></a>Barrier</h4><h4 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h4><h4 id="Placeholder"><a href="#Placeholder" class="headerlink" title="Placeholder"></a>Placeholder</h4><h4 id="GuideLine"><a href="#GuideLine" class="headerlink" title="GuideLine"></a>GuideLine</h4><p>本章部分参考：<a href="https://www.jianshu.com/p/17ec9bd6ca8a" target="_blank" rel="noopener">约束布局ConstraintLayout看这一篇就够了</a></p>
<h3 id="代码布局组件"><a href="#代码布局组件" class="headerlink" title="代码布局组件"></a>代码布局组件</h3><h4 id="Message、Layout过程概述"><a href="#Message、Layout过程概述" class="headerlink" title="Message、Layout过程概述"></a>Message、Layout过程概述</h4><h4 id="关于LayoutParams"><a href="#关于LayoutParams" class="headerlink" title="关于LayoutParams"></a>关于LayoutParams</h4><h4 id="代码中动态定义View"><a href="#代码中动态定义View" class="headerlink" title="代码中动态定义View"></a>代码中动态定义View</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E3%80%8E%E5%B8%83%E5%B1%80%E3%80%8F/" data-id="ck8qp09gk0030lz2663ksepem" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B8%83%E5%B1%80%E7%9B%B8%E5%85%B3/" rel="tag">布局相关</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android代码片段" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/" class="article-date">
  <time datetime="2020-03-19T07:54:49.076Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/">Android代码片段</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="集成Arouter"><a href="#集成Arouter" class="headerlink" title="集成Arouter"></a>集成Arouter</h4><ol>
<li><p>在lib_base的build.gradle中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  com.alibaba:arouter-api:<span class="number">1.4</span><span class="number">.1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在功能Module的build.gralde中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">     ...</span><br><span class="line">        <span class="comment">//阿里路由框架配置</span></span><br><span class="line">        javaCompileOptions &#123;</span><br><span class="line">            annotationProcessorOptions &#123;</span><br><span class="line">                arguments = [AROUTER_MODULE_NAME: project.getName()]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    annotationProcessor <span class="string">'com.alibaba:arouter-compiler:1.1.4'</span></span><br><span class="line">    <span class="function">implementation <span class="title">project</span><span class="params">(<span class="string">':lib_base'</span>)</span> <span class="comment">//引用lib_base</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="配置功能Module的共同引用的config-gradle"><a href="#配置功能Module的共同引用的config-gradle" class="headerlink" title="配置功能Module的共同引用的config.gradle"></a>配置功能Module的共同引用的config.gradle</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isModule.toBoolean()) &#123;</span><br><span class="line">    <span class="comment">//作为独立App应用运行</span></span><br><span class="line">    apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//作为组件运行</span></span><br><span class="line">    apply plugin: <span class="string">'com.android.library'</span></span><br><span class="line">&#125;</span><br><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">//阿里路由框架配置</span></span><br><span class="line">        javaCompileOptions &#123;</span><br><span class="line">            annotationProcessorOptions &#123;</span><br><span class="line">                arguments = [AROUTER_MODULE_NAME: project.getName()]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</span><br><span class="line">            <span class="keyword">if</span> (isModule.toBoolean()) &#123;</span><br><span class="line">                <span class="comment">//独立运行</span></span><br><span class="line">                manifest.srcFile <span class="string">'src/main/module/AndroidManifest.xml'</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//合并到宿主</span></span><br><span class="line">                manifest.srcFile <span class="string">'src/main/AndroidManifest.xml'</span></span><br><span class="line">                resources &#123;</span><br><span class="line">                    <span class="comment">//正式版本时，排除alone文件夹下所有调试文件</span></span><br><span class="line">                    exclude <span class="string">'src/module/alone/*'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line">    dataBinding &#123;</span><br><span class="line">        enabled <span class="keyword">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置lib-base的build-gradle"><a href="#配置lib-base的build-gradle" class="headerlink" title="配置lib_base的build.gradle"></a>配置lib_base的build.gradle</h4><p>在lib_base中配置功能Module需要用到的support、Glide、Kotlin、Arouter等类库，其自身因为不需要进行页面跳转，所以不用引用Arouter。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.library'</span></span><br><span class="line">apply plugin: <span class="string">'kotlin-android-extensions'</span></span><br><span class="line">apply plugin: <span class="string">'kotlin-android'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion rootProject.ext.android.compileSdkVersion</span><br><span class="line">    buildToolsVersion rootProject.ext.android.buildToolsVersion</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion rootProject.ext.android.minSdkVersion</span><br><span class="line">        targetSdkVersion rootProject.ext.android.targetSdkVersion</span><br><span class="line">        versionCode rootProject.ext.android.versionCode</span><br><span class="line">        versionName rootProject.ext.android.versionName</span><br><span class="line">    &#125;</span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</span><br><span class="line">            <span class="keyword">if</span> (isModule) &#123;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resources &#123;</span><br><span class="line">                    <span class="comment">//正式版本时，排除debug文件夹下所有调试文件</span></span><br><span class="line">                    exclude <span class="string">'src/debug/*'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="keyword">false</span></span><br><span class="line">            <span class="function">proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android-optimize.txt'</span>)</span>, 'proguard-rules.pro'</span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//Retrofit/RxJava/Glide/RxBinding/OKHttp/Kotlin/RecyclerViewHelper/EventBus/ButterKnife</span></span></span><br><span class="line"><span class="function">dependencies </span>&#123;</span><br><span class="line">    <span class="function">api <span class="title">files</span><span class="params">(<span class="string">'libs/afinal_0.5.jar'</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">//公用的support相关库在base中依赖</span></span></span><br><span class="line"><span class="function">    api rootProject.ext.support["design"]</span></span><br><span class="line"><span class="function">    api rootProject.ext.support["appcompat-v7"]</span></span><br><span class="line"><span class="function">    api rootProject.ext.support["recyclerview-v7"]</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">//Recycler-Helper</span></span></span><br><span class="line"><span class="function">    api rootProject.ext.dependencies["recyclerHelper"]</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// Glide</span></span></span><br><span class="line"><span class="function">    api rootProject.ext.dependencies["glide"]</span></span><br><span class="line"><span class="function">    annotationProcessor rootProject.ext.dependencies["glide-compiler"]</span></span><br><span class="line"><span class="function">    <span class="comment">// OKHttp</span></span></span><br><span class="line"><span class="function">    api rootProject.ext.dependencies["okhttp"]</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">//kotlin</span></span></span><br><span class="line"><span class="function">    api "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></span><br><span class="line"><span class="function">      </span></span><br><span class="line"><span class="function">    <span class="comment">//阿里路由框架</span></span></span><br><span class="line"><span class="function">    api rootProject.ext.dependencies["arouter-api"]</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function">repositories </span>&#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="集成Kotlin"><a href="#集成Kotlin" class="headerlink" title="集成Kotlin"></a>集成Kotlin</h4><ol>
<li><p>在项目根目录下的build.gradle添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ext.kotlin_version = <span class="string">'1.3.21'</span></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在module的build.gradle中，注意是<font color="#dd0000"><strong>jdk7</strong></font>，不是<strong>jre7</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'kotlin-android'</span></span><br><span class="line">apply plugin: <span class="string">'kotlin-android-extensions'</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">  <span class="comment">//$&#123;kotlin_version&#125;会读取根目录的build.gralde的ext.kotlin_version值填入</span></span><br><span class="line">	api <span class="string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="集成Glide"><a href="#集成Glide" class="headerlink" title="集成Glide"></a>集成Glide</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/" data-id="ck8qp09gm0035lz2672n68y6z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『保活相关』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E3%80%8E%E4%BF%9D%E6%B4%BB%E7%9B%B8%E5%85%B3%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.075Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E3%80%8E%E4%BF%9D%E6%B4%BB%E7%9B%B8%E5%85%B3%E3%80%8F/">Android『保活相关』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><h4 id="Service的兼容"><a href="#Service的兼容" class="headerlink" title="Service的兼容"></a>Service的兼容</h4><ol>
<li>5.0以后不再支持隐式Intent方式启动外部Service。</li>
<li>8.0以后对后台服务有了更多的限制，对服务做了前台服务、后台服务的区分。<strong>应用进入后台时，有一个短暂的时间窗口，可以在该时间窗口内创建和使用服务，在时间窗口结束后，应用将被视为空闲状态，此时，系统将停止应用的</strong><font color="#dd0000"><strong>后台服务</strong></font>，就像应用已经调用服务的<strong>Service.stopSelf()</strong>一样。</li>
<li>基于<strong>2</strong>，Android 8.0引入了一个新方法<strong>Context.startForegroundService()</strong>，在系统创建服务后，应用有五秒的时间调用startForeground()，来显示新服务的可见通知(Notification)。<strong>如果应用在此期间限制内未调用startForeground()，则系统将停止并声明此应用为ANR</strong>。</li>
<li>Android在8.0限制了后台服务这些，启动后台服务需要设置通知栏，使服务变成前台服务。但是在<font color="#dd0000"><strong>9.0</strong></font>上，就会出现<code>Permission Denial: startForeground requires android.permission.FOREGROUND_SERVICE</code>。</li>
</ol>
<h3 id="保活方案"><a href="#保活方案" class="headerlink" title="保活方案"></a>保活方案</h3><ol>
<li><p>一像素包活</p>
<p>据说这个是手Q的进程保活方案，基本思想，系统一般是不会杀死前台进程的。所以要使得进程常驻，我们只需要在锁屏的时候在本进程开启一个Activity，为了欺骗用户，让这个Activity的大小是1像素，并且透明无切换动画，在开屏幕的时候，把这个Activity关闭掉，所以这个就需要监听系统锁屏广播.<br>————————————————<br>版权声明：本文为CSDN博主「_YoungMan」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_37199105/article/details/81224842" target="_blank" rel="noopener">https://blog.csdn.net/qq_37199105/article/details/81224842</a></p>
</li>
<li><p>通知栏显示前台服务</p>
<p>据说这个微信也用过的进程保活方案，该方案实际利用了Android前台service的漏洞。<br>原理如下<br>对于 API level &lt; 18 ：调用startForeground(ID， new Notification())，发送空的Notification ，图标则不会显示。<br>对于 API level &gt;= 18：在需要提优先级的service A启动一个InnerService，两个服务同时startForeground，且绑定同样的 ID。Stop 掉InnerService ，这样通知栏图标即被移除。<br>————————————————<br>版权声明：本文为CSDN博主「_YoungMan」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_37199105/article/details/81224842" target="_blank" rel="noopener">https://blog.csdn.net/qq_37199105/article/details/81224842</a></p>
</li>
<li><p>双进程保活</p>
<p>顾名思义,就是指的不同进程,不同app之间互相唤醒,如你手机里装了支付宝、淘宝、天猫、UC等阿里系的app，那么你打开任意一个阿里系的app后，有可能就顺便把其他阿里系的app给唤醒了。</p>
</li>
<li><p>JobScheduler</p>
<p>JobSheduler是作为进程死后复活的一种手段，native进程方式最大缺点是费电， Native 进程费电的原因是感知主进程是否存活有两种实现方式，在 Native 进程中通过死循环或定时器，轮训判断主进程是否存活，当主进程不存活时进行拉活。其次5.0以上系统不支持。 但是JobSheduler可以替代在Android5.0以上native进程方式，这种方式即使用户强制关闭，也能被拉起来，亲测可行。<br>————————————————<br>版权声明：本文为CSDN博主「_YoungMan」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_37199105/article/details/81224842" target="_blank" rel="noopener">https://blog.csdn.net/qq_37199105/article/details/81224842</a></p>
</li>
<li><p>粘性服务&amp;与系统服务捆绑</p>
<p>这个是系统自带的，onStartCommand方法必须具有一个整形的返回值，这个整形的返回值用来告诉系统在服务启动完毕后，如果被Kill，系统将如何操作，这种方案虽然可以，但是在某些情况or某些定制ROM上可能失效，<strong>我认为可以多做一种保保守方案</strong>。</p>
<p>START_STICKY<br>如果系统在onStartCommand返回后被销毁，系统将会重新创建服务并依次调用onCreate和onStartCommand（注意：根据测试Android2.3.3以下版本只会调用onCreate根本不会调用onStartCommand，Android4.0可以办到），这种相当于服务又重新启动恢复到之前的状态了）。</p>
<p>START_NOT_STICKY<br>如果系统在onStartCommand返回后被销毁，如果返回该值，则在执行完onStartCommand方法后如果Service被杀掉系统将不会重启该服务。</p>
<p>START_REDELIVER_INTENT<br>START_STICKY的兼容版本，不同的是其不保证服务被杀后一定能重启。<br>————————————————<br>版权声明：本文为CSDN博主「cmyperson」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/cmyperson/article/details/89524921" target="_blank" rel="noopener">https://blog.csdn.net/cmyperson/article/details/89524921</a></p>
</li>
<li><p>显式Service互调，需要一定的流量，并和其他APP约定互调路径，参数</p>
</li>
<li><p>显式Activity互调，需要一定的流量，并和其他APP约定互调路径，参数</p>
</li>
<li><p>使用JetPack中的WorkManager进行保活</p>
</li>
<li><p>播放无声背景音乐保活（仅限用户点击清理全部时，不被结束）</p>
</li>
<li><p>集成厂商推送SDK进行进程保活，以华为为例：</p>
<p>与个推、小米、极光推送类似，华为Push也是为开发者提供的一个消息推送平台，它建立了从云端到手机端的消息推送通道，支持上报标签、LBS信息、通知推送。换句话来说，就算我们的APP没有自己的服务器，也可以通过这些第三方推送平台，把最新消息及时地通知用户。</p>
<p><strong>华为推送复活原理：</strong>华为推送服务以后台Service方式运行在一个独立进程里，主程序不需要常驻内存。当该后台Service接收到push消息后会以广播的方式通知主进程，触发相关回调接口。通常，被强制停止的APP无法接收到广播，但是华为push通道(即推送后台Service，它会常驻内存)能够强行将APP拉起来，这是因为其在发广播时利用了Intent.FLAG_INCLUDE_STOPPED_PACKAGES标记实现的。</p>
<p><a href="http://www.52im.net/thread-1140-1-1.html" target="_blank" rel="noopener">http://www.52im.net/thread-1140-1-1.html</a></p>
</li>
<li><p>自定义锁屏界面</p>
</li>
<li><p>同派系APP广播互相唤醒</p>
</li>
<li><p>仿TIM引导用户打开“后台自启动”和加入“手机白名单”。</p>
</li>
</ol>
<h3 id="已失效？？"><a href="#已失效？？" class="headerlink" title="已失效？？"></a>已失效？？</h3><p>盘点已经失效或者不适合的保活黑科技，这里的“不适合”是因为我们做政府项目，后台是布在内网上的。</p>
<p>1.双进程守护方案，华为6.0就失效</p>
<p>2.监听锁屏/亮屏/解锁广播，打开1像素Activity，华为6.0就失效，因广播被取消了</p>
<p>3.故意在后台播放无声的音乐，华为M10手机9.0失效</p>
<p>4.使用JobScheduler唤醒Service，7.0以上失效</p>
<p>5.集成华为/小米/oppo/vivo/魅族等push，因为项目本地化部署，不适合</p>
<p>6.推送互相唤醒复活：极光、友盟、以及各大厂商的推送，因为项目本地化部署，不适合</p>
<p>7.同派系APP广播互相唤醒：比如今日头条系、阿里系，因为项目本地化部署，不适合</p>
<p>8.使用自定义锁屏界面：覆盖了系统锁屏界面。网易云音乐就是如此，但是会生成一个常驻通知栏的通知</p>
<p>9.把APP设置为系统应用，不适合，因为需要权限等</p>
<p>10.native进程(已报废)</p>
<p>11.利用账号同步机制拉活,失效了</p>
<ol start="12">
<li>提高Service优先级，比如onStartCommand返回START_STICKY，没什么效果<br>————————————————<br>版权声明：本文为CSDN博主「嵩风抚」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/u012482178/article/details/95218872" target="_blank" rel="noopener">https://blog.csdn.net/u012482178/article/details/95218872</a></li>
<li></li>
</ol>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="ServiceConnection"><a href="#ServiceConnection" class="headerlink" title="ServiceConnection"></a>ServiceConnection</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E3%80%8E%E4%BF%9D%E6%B4%BB%E7%9B%B8%E5%85%B3%E3%80%8F/" data-id="ck8qp09gj002wlz26giqc61j4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『JNI-C-NDK』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E3%80%8EJNI-C-NDK%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.074Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E3%80%8EJNI-C-NDK%E3%80%8F/">Android『JNI/C++/NDK』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h3><h4 id="加载方式"><a href="#加载方式" class="headerlink" title="加载方式"></a>加载方式</h4><p>so文件是不能随便放到一个指定的目录然后再通过参数pathName直接引用的。因为System.load只能加载两个目录路径下的so文件： /system/lib ; 安装包的路径，即：/data/data//… <strong>而且这两个路劲又是有权限保护的不能直接访问;</strong></p>
<p>System.load(filename)：filename必须是绝对路径</p>
<ol>
<li>静态加载</li>
</ol>
<ol start="2">
<li>动态加载</li>
</ol>
<p>参考文章：</p>
<p><a href="https://blog.csdn.net/iliupp/article/details/70765891?utm_source=blogxgwz8" target="_blank" rel="noopener">Android——JNI加载so两种方式</a></p>
<p><a href="https://www.cnblogs.com/butterfly-clover/p/5684301.html" target="_blank" rel="noopener">System.load 与 System.loadLibrary 的区别</a></p>
<h4 id="Android中生成SO文件"><a href="#Android中生成SO文件" class="headerlink" title="Android中生成SO文件"></a>Android中生成SO文件</h4><p>参考文章：</p>
<p><a href="https://www.jianshu.com/p/7b57a19448c6" target="_blank" rel="noopener">学习JNI编程第1篇–写一个FactorialDemo APP</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E3%80%8EJNI-C-NDK%E3%80%8F/" data-id="ck8qp09ge002rlz26anz5ezeh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jni/" rel="tag">jni</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ndk/" rel="tag">ndk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android『MVP模式』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E3%80%8EMVP%E6%A8%A1%E5%BC%8F%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.074Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E3%80%8EMVP%E6%A8%A1%E5%BC%8F%E3%80%8F/">Android『MVP模式』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E3%80%8EMVP%E6%A8%A1%E5%BC%8F%E3%80%8F/" data-id="ck8qp09gh002tlz267lsbchka" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『DarkMode适配』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E3%80%8EDarkMode%E9%80%82%E9%85%8D%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.073Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E3%80%8EDarkMode%E9%80%82%E9%85%8D%E3%80%8F/">Android『DarkMode适配』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Android 10+上的DarkMode适配</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E3%80%8EDarkMode%E9%80%82%E9%85%8D%E3%80%8F/" data-id="ck8qp09g2002mlz26dude2rx1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android『AnnotationProcessor基础』" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/Android%E3%80%8EAnnotationProcessor%E5%9F%BA%E7%A1%80%E3%80%8F/" class="article-date">
  <time datetime="2020-03-19T07:54:49.073Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/Android%E3%80%8EAnnotationProcessor%E5%9F%BA%E7%A1%80%E3%80%8F/">Android『AnnotationProcessor基础』</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>看看AnnotationProcessor，是Android替代APT(个人开发者开发的，已停止维护)的编译器生成代码的库。注入Dagger2、EventBus、ButterKnife都使用了AnnotationProcessor来实现功能。先了解一下基本知识：</p>
<h4 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h4><p>元注解指的是<strong>用来修饰注解的注解</strong>，包括：</p>
<ul>
<li>@Retention：定义注解的保留策略</li>
<li>@Target：定义注解的作用目标</li>
<li>@Inherited：说明该注解将被包含在javadoc中</li>
<li>@Documented：说明子类可以继承父类中的该注解</li>
</ul>
<h4 id="RetentionPolicy"><a href="#RetentionPolicy" class="headerlink" title="RetentionPolicy"></a>RetentionPolicy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java.lang.annotation.RetentionPolicy.java</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Annotation retention policy.  The constants of this enumerated type</span></span><br><span class="line"><span class="comment"> * describe the various policies for retaining annotations.  They are used</span></span><br><span class="line"><span class="comment"> * in conjunction with the &#123;<span class="doctag">@link</span> Retention&#125; meta-annotation type to specify</span></span><br><span class="line"><span class="comment"> * how long annotations are to be retained.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  Joshua Bloch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RetentionPolicy &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Annotations are to be discarded by the compiler.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SOURCE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Annotations are to be recorded in the class file by the compiler</span></span><br><span class="line"><span class="comment">     * but need not be retained by the VM at run time.  This is the default</span></span><br><span class="line"><span class="comment">     * behavior.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CLASS,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Annotations are to be recorded in the class file by the compiler and</span></span><br><span class="line"><span class="comment">     * retained by the VM at run time, so they may be read reflectively.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.lang.reflect.AnnotatedElement</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RUNTIME</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个枚举表示注解的保留策略，他们会在元注解Retention中使用到，用来指定对应的注解能够保留多久。</p>
<ul>
<li>SOURCE，注解会被编译器移除</li>
<li>CLASS，注解可以编译器的保留在class文件中，<strong>但是不能在虚拟机运行时保留</strong>。这也是默认的注解保留行为。</li>
<li>RUNTIME，注解可以在编译器及虚拟机的运行都保留下来，所以这时注解可以用反射读取。</li>
</ul>
<h4 id="ElementType"><a href="#ElementType" class="headerlink" title="ElementType"></a>ElementType</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java.lang.annotation.ElementType.java</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这些常量用来表明注解的注解范围。在元注解Target中使用得到。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ElementType &#123;</span><br><span class="line">    <span class="comment">/** 类，接口(含注解)*/</span></span><br><span class="line">    TYPE,</span><br><span class="line">    <span class="comment">/** 成员变量(含枚举常量) */</span></span><br><span class="line">    FIELD,</span><br><span class="line">    <span class="comment">/** 方法声明 */</span></span><br><span class="line">    METHOD,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 参数声明 */</span></span><br><span class="line">    PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 构造方法声明 */</span></span><br><span class="line">    CONSTRUCTOR,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 局部变量声明 */</span></span><br><span class="line">    LOCAL_VARIABLE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 注解声明 */</span></span><br><span class="line">    ANNOTATION_TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 包声明 */</span></span><br><span class="line">    PACKAGE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类型变量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 任何使用类型的地方</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_USE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结来说你需要三个文件：</p>
<p>一个自定义的注解、一个自定义的AbstractProcessor用于基于自定义注解生成java文件、以及一个工具类Tool用于绑定/触发生成java文件动作。</p>
<p>大概过程是当我们Activity A中调用Tool的action()方法触发绑定动作时，会连接到AbstractPRocessor，而AbstractProcessor中有自定义的处理逻辑，大致流程是遍历Activity A中所有的复合条件的注解修饰对象，然后对这些对象调用方法。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/Android%E3%80%8EAnnotationProcessor%E5%9F%BA%E7%A1%80%E3%80%8F/" data-id="ck8qp09g4002olz263n8dh6ec" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AnnotationProcessor/" rel="tag">AnnotationProcessor</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/17/hello-world/" class="article-date">
  <time datetime="2020-03-17T08:07:16.333Z" itemprop="datePublished">2020-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/17/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/17/hello-world/" data-id="ck8qp09hb004mlz26g2h7foh9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AnnotationProcessor/" rel="tag">AnnotationProcessor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Framework/" rel="tag">Framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/" rel="tag">Retrofit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava2/" rel="tag">RxJava2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jni/" rel="tag">jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ndk/" rel="tag">ndk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%83%E5%B1%80%E7%9B%B8%E5%85%B3/" rel="tag">布局相关</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%EF%BC%8Cprotobuf/" rel="tag">数据转换，protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" rel="tag">源码学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" rel="tag">编程语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">读书笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/AnnotationProcessor/" style="font-size: 10px;">AnnotationProcessor</a> <a href="/tags/Framework/" style="font-size: 10px;">Framework</a> <a href="/tags/Java/" style="font-size: 16.67px;">Java</a> <a href="/tags/Kotlin/" style="font-size: 10px;">Kotlin</a> <a href="/tags/Retrofit/" style="font-size: 10px;">Retrofit</a> <a href="/tags/RxJava2/" style="font-size: 13.33px;">RxJava2</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jni/" style="font-size: 10px;">jni</a> <a href="/tags/ndk/" style="font-size: 10px;">ndk</a> <a href="/tags/%E5%B8%83%E5%B1%80%E7%9B%B8%E5%85%B3/" style="font-size: 10px;">布局相关</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%EF%BC%8Cprotobuf/" style="font-size: 10px;">数据转换，protobuf</a> <a href="/tags/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">源码学习</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">编程语言</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.33px;">设计模式</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="font-size: 16.67px;">读书笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/03/19/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%8EJava%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8F/">读书笔记『Java并发编程实战』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E3%80%8E%E8%85%BE%E8%AE%AFMMKV%E5%AD%98%E5%82%A8%E6%A1%86%E6%9E%B6%E3%80%8F/">开源项目『腾讯MMKV存储框架』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94OkHttp%E3%80%8E%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E3%80%8F/">OkHttp『源码学习-杂项』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/Java%E7%B1%BB%E5%BA%93%E5%AD%A6%E4%B9%A0%E3%80%8EProtocolBuffers%E3%80%8F/">Java类库学习『ProtocolBuffers』</a>
          </li>
        
          <li>
            <a href="/2020/03/19/Java%E8%BF%9B%E9%98%B6%E3%80%8EJavassist%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E3%80%8F/">Java进阶『Javassist学习笔记』</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="http://cdn.bootcss.com/jquery/2.1.1/jquery.min.js“ > </script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>